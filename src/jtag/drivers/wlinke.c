/*
 * WCH_LINLK port debug driver for WCH RISC-V mcu :
   CH32V103X;CH32V20X,CH32V30X;CH56X;CH57X;CH58X
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License as
 * published by the Free Software Foundation; either version 2 of
 * the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif
#include <jtag/adapter.h>
#include <jtag/interface.h>
#include <jtag/commands.h>
#ifdef HAVE_ARPA_INET_H
#include <arpa/inet.h>
#endif
#include "cmsis_dap.h"
#ifdef _WIN32
#include <windows.h>
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <stdint.h>
#include "hidapi.h"
typedef int(__stdcall *pCH375OpenDevice)(unsigned long iIndex);
typedef void(__stdcall *pCH375CloseDevice)(unsigned long iIndex);
typedef unsigned long(__stdcall *pCH375SetTimeout)(unsigned long iIndex,
												   unsigned long iWriteTimeout,
												   unsigned long iReadTimeout);
typedef unsigned long(__stdcall *pCH375ReadEndP)(unsigned long iIndex,
												 unsigned long iPipeNum,
												 void *iBuffer,
												 unsigned long *ioLength);
typedef unsigned long(__stdcall *pCH375WriteEndP)(unsigned long iIndex,
												  unsigned long iPipeNum,
												  void *iBuffer,
												  unsigned long *ioLength);
HMODULE hModule = 0;
BOOL gOpen = FALSE;
ULONG gIndex = 0;
pCH375OpenDevice pOpenDev;
pCH375CloseDevice pCloseDev;
pCH375SetTimeout pSetTimeout;
pCH375ReadEndP pReadData;
pCH375WriteEndP pWriteData;
#else
#include "libusb_helper.h"
#include <stdbool.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <fcntl.h>
#include <string.h>
#include <sys/ioctl.h>
#include <stdint.h>
int gIndex = 0;
static const uint16_t wlink_vids[] = {0x1a86, 0};
static const uint16_t wlink_pids[] = {0x8010, 0};
struct jtag_libusb_device_handle *wfd = NULL;
int pWriteData(int dev, int endpoint, unsigned char *buf, unsigned long *length)
{
	int ret, pr;
	length = (int *)length;
	ret = jtag_libusb_bulk_write(wfd, endpoint, buf, *length, 3000, &pr);
	if (ret == ERROR_OK)
		return 1;
	else
		return ret;
}
int pReadData(int dev, int endpoint, unsigned char *buf, unsigned long *length)
{
	int ret, pr;
	length = (int *)length;
	if (endpoint == 1)
	{
		ret = jtag_libusb_bulk_read(wfd, 0x81, buf, *length, 3000, &pr);
	}
	else
	{
		ret = jtag_libusb_bulk_read(wfd, 0x82, buf, *length, 3000, &pr);
	}
	if (ret == ERROR_OK)
		return 1;
	else
		return ret;
}
#endif
unsigned long wlink_address = 0;
bool wlink549 = false;
bool wlinkw = false;
bool wlinke = false;
bool pageerase = false;
bool powstat =false ;
int iocontrol =0;
unsigned long  poutput = -1;
// bool protectcheck=false;
unsigned char riscvchip;
unsigned int chip_type;
unsigned long chipiaddr;
unsigned long pagesize;
unsigned long ramaddr;
bool noloadflag = false;
extern int writeloop;
uint8_t sp=1;
uint8_t flash_op103[ ] ={
    0x01, 0x11, 0x02, 0xCE, 0x93, 0x77, 0x15, 0x00, 0x99, 0xCF, 0xB7, 0x06, 0x67, 0x45, 0xB7, 0x27, 
    0x02, 0x40, 0x93, 0x86, 0x36, 0x12, 0x37, 0x97, 0xEF, 0xCD, 0xD4, 0xC3, 0x13, 0x07, 0xB7, 0x9A, 
    0xD8, 0xC3, 0xD4, 0xD3, 0xD8, 0xD3, 0x93, 0x77, 0x25, 0x00, 0x9D, 0xC7, 0xB7, 0x27, 0x02, 0x40, 
    0x98, 0x4B, 0xAD, 0x66, 0x37, 0x38, 0x00, 0x40, 0x13, 0x67, 0x47, 0x00, 0x98, 0xCB, 0x98, 0x4B, 

    0x93, 0x86, 0xA6, 0xAA, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x63, 0x1F, 
    0x07, 0x10, 0x98, 0x4B, 0x6D, 0x9B, 0x98, 0xCB, 0x93, 0x77, 0x45, 0x00, 0xA9, 0xCB, 0x93, 0x07, 
    0xF6, 0x07, 0x9D, 0x83, 0x2E, 0xC6, 0x2D, 0x68, 0x81, 0x76, 0x3E, 0xCA, 0xB7, 0x08, 0x02, 0x00, 
    0xB7, 0x27, 0x02, 0x40, 0x37, 0x33, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0xFD, 0x16, 0x98, 0x4B, 

    0x33, 0x67, 0x17, 0x01, 0x98, 0xCB, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 0x07, 0x04, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x71, 0xEF, 0x98, 0x4B, 0x75, 0x8F, 0x98, 0xCB, 0x32, 0x47, 
    0x13, 0x07, 0x07, 0x08, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 0x69, 0xFB, 0x93, 0x77, 
    0x85, 0x00, 0xED, 0xC3, 0x93, 0x07, 0xF6, 0x07, 0x2E, 0xC6, 0x9D, 0x83, 0x37, 0x27, 0x02, 0x40, 

    0x3E, 0xCA, 0x1C, 0x4B, 0xC1, 0x66, 0x37, 0x08, 0x08, 0x00, 0xD5, 0x8F, 0x1C, 0xCB, 0xA1, 0x48, 
    0x37, 0x17, 0x00, 0x20, 0xB7, 0x27, 0x02, 0x40, 0x37, 0x03, 0x04, 0x00, 0x94, 0x4B, 0xB3, 0xE6, 
    0x06, 0x01, 0x94, 0xCB, 0xD4, 0x47, 0x85, 0x8A, 0xF5, 0xFE, 0xB2, 0x46, 0x3A, 0x8E, 0x36, 0xC8, 
    0x46, 0xCC, 0xC2, 0x46, 0x83, 0x2E, 0x07, 0x00, 0x41, 0x07, 0x23, 0xA0, 0xD6, 0x01, 0xC2, 0x46, 

    0x83, 0x2E, 0x47, 0xFF, 0x23, 0xA2, 0xD6, 0x01, 0xC2, 0x46, 0x83, 0x2E, 0x87, 0xFF, 0x23, 0xA4, 
    0xD6, 0x01, 0xC2, 0x46, 0x03, 0x2E, 0xCE, 0x00, 0x23, 0xA6, 0xC6, 0x01, 0x94, 0x4B, 0xB3, 0xE6, 
    0x66, 0x00, 0x94, 0xCB, 0xD4, 0x47, 0x85, 0x8A, 0xF5, 0xFE, 0xC2, 0x46, 0x3A, 0x8E, 0xC1, 0x06, 
    0x36, 0xC8, 0xE2, 0x46, 0xFD, 0x16, 0x36, 0xCC, 0xCD, 0xFE, 0xB2, 0x46, 0xD4, 0xCB, 0x94, 0x4B, 

    0x93, 0xE6, 0x06, 0x04, 0x94, 0xCB, 0xD4, 0x47, 0x85, 0x8A, 0xF5, 0xFE, 0xD4, 0x47, 0xD1, 0x8A, 
    0x85, 0xC6, 0xD8, 0x47, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x13, 0x67, 0x47, 0x01, 0xD8, 0xC7, 
    0x98, 0x4B, 0x21, 0x45, 0x75, 0x8F, 0x98, 0xCB, 0x05, 0x61, 0x02, 0x90, 0x23, 0x20, 0xD8, 0x00, 
    0xE9, 0xBD, 0x23, 0x20, 0x03, 0x01, 0x31, 0xBF, 0xB2, 0x46, 0x93, 0x86, 0x06, 0x08, 0x36, 0xC6, 

    0xD2, 0x46, 0xFD, 0x16, 0x36, 0xCA, 0xB9, 0xFA, 0x98, 0x4B, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 
    0x75, 0x8F, 0x98, 0xCB, 0x41, 0x89, 0x19, 0xE1, 0x01, 0x45, 0xF9, 0xB7, 0x2E, 0xC6, 0x0D, 0x06, 
    0x02, 0xCA, 0x09, 0x82, 0x32, 0xCC, 0xB7, 0x17, 0x00, 0x20, 0x98, 0x43, 0x13, 0x86, 0x47, 0x00, 
    0xD2, 0x47, 0xB2, 0x46, 0x8A, 0x07, 0xB6, 0x97, 0x9C, 0x43, 0x63, 0x18, 0xF7, 0x02, 0xD2, 0x47, 

    0x32, 0x47, 0x8A, 0x07, 0xBA, 0x97, 0x98, 0x43, 0xF2, 0x47, 0xBA, 0x97, 0x3E, 0xCE, 0xD2, 0x47, 
    0x85, 0x07, 0x3E, 0xCA, 0xD2, 0x46, 0x62, 0x47, 0xB2, 0x87, 0xE3, 0xE8, 0xE6, 0xFC, 0xB7, 0x27, 
    0x00, 0x20, 0x98, 0x4B, 0xF2, 0x47, 0xE3, 0x09, 0xF7, 0xFA, 0x41, 0x45, 0xB5, 0xBF, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};
uint8_t flash_op569[ ] ={
    0x79, 0x71, 0x22, 0xD4, 0x4A, 0xD0, 0x56, 0xCA, 0x06, 0xD6, 0x26, 0xD2, 0x4E, 0xCE, 0x52, 0xCC, 
    0x5A, 0xC8, 0x5E, 0xC6, 0x62, 0xC4, 0x93, 0x77, 0x15, 0x00, 0x2A, 0x84, 0xAE, 0x8A, 0x32, 0x89, 
    0xBD, 0xE7, 0x93, 0x77, 0x24, 0x00, 0x99, 0xC7, 0xB7, 0x85, 0x07, 0x00, 0x01, 0x45, 0xA9, 0x2C, 
    0x89, 0x47, 0x35, 0xE1, 0x93, 0x77, 0x44, 0x00, 0x91, 0xC7, 0x85, 0x65, 0x56, 0x85, 0xA9, 0x24, 

    0x91, 0x47, 0x31, 0xE9, 0x93, 0x77, 0x84, 0x01, 0x01, 0x4A, 0xD9, 0xC7, 0xB7, 0x14, 0x00, 0x20, 
    0x13, 0x09, 0xF9, 0x0F, 0x93, 0x84, 0x04, 0x10, 0x13, 0x59, 0x89, 0x00, 0x01, 0x4A, 0xB3, 0x8A, 
    0x9A, 0x40, 0x93, 0x7B, 0x84, 0x00, 0x13, 0x7C, 0x04, 0x01, 0x33, 0x8B, 0x9A, 0x00, 0x63, 0x91, 
    0x0B, 0x04, 0x63, 0x0E, 0x0C, 0x04, 0x93, 0x89, 0x04, 0xF0, 0x13, 0x06, 0x00, 0x10, 0xCE, 0x85, 

    0x5A, 0x85, 0x2D, 0x26, 0x13, 0x75, 0xF5, 0x0F, 0x0D, 0xCD, 0xC1, 0x47, 0x29, 0xA0, 0x01, 0x45, 
    0x69, 0x2E, 0x85, 0x47, 0x59, 0xD5, 0xB2, 0x50, 0x22, 0x54, 0x92, 0x54, 0x02, 0x59, 0xF2, 0x49, 
    0x62, 0x4A, 0xD2, 0x4A, 0x42, 0x4B, 0xB2, 0x4B, 0x22, 0x4C, 0x3E, 0x85, 0x45, 0x61, 0x02, 0x90, 
    0x13, 0x06, 0x00, 0x10, 0x93, 0x85, 0x04, 0xF0, 0x5A, 0x85, 0xCD, 0x22, 0x5D, 0xD9, 0xA1, 0x47, 

    0xD9, 0xBF, 0x83, 0xA7, 0x09, 0x00, 0x91, 0x09, 0x3E, 0x9A, 0xE3, 0x9C, 0x34, 0xFF, 0x7D, 0x19, 
    0x93, 0x84, 0x04, 0x10, 0xE3, 0x1B, 0x09, 0xF8, 0x41, 0x88, 0x81, 0x47, 0x4D, 0xDC, 0x37, 0x67, 
    0x00, 0x20, 0x18, 0x4B, 0xE3, 0x09, 0x47, 0xFB, 0x4D, 0xB7, 0xB7, 0x17, 0x00, 0x40, 0x23, 0x8D, 
    0x07, 0x00, 0x1D, 0x47, 0x23, 0x8D, 0xE7, 0x00, 0x23, 0x8C, 0xA7, 0x00, 0x82, 0x80, 0x37, 0x17, 

    0x00, 0x40, 0x83, 0x47, 0xA7, 0x01, 0xE2, 0x07, 0xE1, 0x87, 0xE3, 0xCC, 0x07, 0xFE, 0x23, 0x0D, 
    0x07, 0x00, 0x82, 0x80, 0x37, 0x17, 0x00, 0x40, 0x83, 0x47, 0xA7, 0x01, 0xE2, 0x07, 0xE1, 0x87, 
    0xE3, 0xCC, 0x07, 0xFE, 0x23, 0x0C, 0xA7, 0x00, 0x82, 0x80, 0x37, 0x17, 0x00, 0x40, 0x83, 0x47, 
    0xA7, 0x01, 0xE2, 0x07, 0xE1, 0x87, 0xE3, 0xCC, 0x07, 0xFE, 0x03, 0x45, 0x87, 0x01, 0x82, 0x80, 

    0x41, 0x11, 0x22, 0xC4, 0x2A, 0x84, 0x41, 0x81, 0x13, 0x75, 0xF5, 0x0F, 0x06, 0xC6, 0xD9, 0x37, 
    0x13, 0x55, 0x84, 0x00, 0x13, 0x75, 0xF5, 0x0F, 0x75, 0x3F, 0x13, 0x75, 0xF4, 0x0F, 0x22, 0x44, 
    0xB2, 0x40, 0x41, 0x01, 0x45, 0xBF, 0x41, 0x11, 0x22, 0xC4, 0x2A, 0x84, 0x19, 0x45, 0x06, 0xC6, 
    0xAD, 0x3F, 0x71, 0x37, 0x22, 0x85, 0x22, 0x44, 0xB2, 0x40, 0x41, 0x01, 0xBD, 0xB7, 0x01, 0x11, 

    0x22, 0xCC, 0x06, 0xCE, 0x37, 0x04, 0x28, 0x00, 0x9D, 0x3F, 0x15, 0x45, 0xB9, 0x3F, 0x71, 0x3F, 
    0x69, 0x3F, 0x2A, 0xC6, 0xAD, 0x37, 0x32, 0x45, 0x05, 0x89, 0x09, 0xC9, 0x7D, 0x14, 0x75, 0xF4, 
    0x13, 0x05, 0xF0, 0x0F, 0xF2, 0x40, 0x62, 0x44, 0x05, 0x61, 0x82, 0x80, 0x01, 0x45, 0xDD, 0xBF, 
    0x85, 0x67, 0xFD, 0x17, 0x01, 0x11, 0xBE, 0x95, 0xE9, 0x8F, 0x26, 0xCA, 0xAE, 0x97, 0xFD, 0x74, 

    0x22, 0xCC, 0x06, 0xCE, 0x33, 0xF4, 0x97, 0x00, 0x4A, 0xC8, 0x4E, 0xC6, 0xE9, 0x8C, 0xB7, 0x06, 
    0x08, 0x00, 0x63, 0xF8, 0xD4, 0x0A, 0xB3, 0x07, 0x94, 0x00, 0x2A, 0x87, 0x13, 0x05, 0xA0, 0x0F, 
    0x63, 0xE3, 0xF6, 0x06, 0xB7, 0x17, 0x00, 0x40, 0x93, 0x06, 0x70, 0x05, 0x23, 0x80, 0xD7, 0x00, 
    0x93, 0x06, 0x80, 0xFA, 0x23, 0x80, 0xD7, 0x00, 0x83, 0xC6, 0x47, 0x00, 0x3D, 0x65, 0x69, 0x8F, 

    0x93, 0xE6, 0xC6, 0x08, 0x23, 0x82, 0xD7, 0x00, 0x11, 0xE7, 0xB7, 0x09, 0x07, 0x00, 0x41, 0x69, 
    0x63, 0xE2, 0x34, 0x05, 0xA2, 0x94, 0x05, 0x69, 0xB3, 0x89, 0x84, 0x40, 0x63, 0x79, 0x24, 0x05, 
    0x01, 0x45, 0x37, 0x17, 0x00, 0x40, 0x93, 0x07, 0x70, 0x05, 0x23, 0x00, 0xF7, 0x00, 0x93, 0x07, 
    0x80, 0xFA, 0x23, 0x00, 0xF7, 0x00, 0x83, 0x47, 0x47, 0x00, 0x93, 0xF7, 0x37, 0x07, 0x93, 0xE7, 

    0x07, 0x08, 0x23, 0x02, 0xF7, 0x00, 0xF2, 0x40, 0x62, 0x44, 0xD2, 0x44, 0x42, 0x49, 0xB2, 0x49, 
    0x05, 0x61, 0x82, 0x80, 0xE3, 0x60, 0x24, 0xFD, 0x13, 0x05, 0x80, 0x0D, 0x29, 0x37, 0x26, 0x85, 
    0xC5, 0x35, 0x31, 0x3F, 0x5D, 0xFD, 0xCA, 0x94, 0x33, 0x04, 0x24, 0x41, 0x55, 0xB7, 0x13, 0x05, 
    0x00, 0x02, 0xD5, 0x3D, 0x4E, 0x85, 0xE9, 0x35, 0x19, 0x37, 0x45, 0xF5, 0x33, 0x04, 0x24, 0x41, 

    0x61, 0xBF, 0x13, 0x05, 0xE0, 0x0F, 0xC1, 0xB7, 0xB7, 0x17, 0x00, 0x40, 0x83, 0xC7, 0x47, 0x00, 
    0xC1, 0x8B, 0x91, 0xE3, 0x31, 0xBF, 0x13, 0x05, 0xB0, 0x0F, 0x82, 0x80, 0x01, 0x11, 0x22, 0xCC, 
    0x37, 0x04, 0x00, 0x10, 0x71, 0x14, 0x69, 0x8C, 0x21, 0x65, 0x2A, 0x94, 0x06, 0xCE, 0x26, 0xCA, 
    0x4A, 0xC8, 0x4E, 0xC6, 0x37, 0x07, 0x08, 0x00, 0x13, 0x05, 0xE0, 0x0F, 0x63, 0x71, 0xE4, 0x0E, 

    0xB3, 0x07, 0xC4, 0x00, 0x13, 0x05, 0xA0, 0x0F, 0x63, 0x6B, 0xF7, 0x0C, 0xB7, 0x17, 0x00, 0x40, 
    0x03, 0xC7, 0x47, 0x00, 0x13, 0x05, 0xB0, 0x0F, 0x41, 0x8B, 0x71, 0xE3, 0x13, 0x07, 0x70, 0x05, 
    0x23, 0x80, 0xE7, 0x00, 0x13, 0x07, 0x80, 0xFA, 0x23, 0x80, 0xE7, 0x00, 0x03, 0xC7, 0x47, 0x00, 
    0x2E, 0x89, 0x93, 0x59, 0x26, 0x00, 0x13, 0x67, 0xC7, 0x08, 0x23, 0x82, 0xE7, 0x00, 0xB7, 0x14, 

    0x00, 0x40, 0x63, 0x94, 0x09, 0x00, 0x01, 0x45, 0x8D, 0xA8, 0x09, 0x45, 0xA9, 0x3D, 0x22, 0x85, 
    0x05, 0x3D, 0x33, 0x05, 0x24, 0x41, 0x11, 0x09, 0x83, 0x27, 0xC9, 0xFF, 0xDC, 0xC8, 0x83, 0xC7, 
    0xA4, 0x01, 0x93, 0xE7, 0x07, 0x01, 0x03, 0xC7, 0xA4, 0x01, 0x62, 0x07, 0x61, 0x87, 0xE3, 0x4C, 
    0x07, 0xFE, 0x23, 0x8D, 0xF4, 0x00, 0x03, 0xC7, 0xA4, 0x01, 0x62, 0x07, 0x61, 0x87, 0xE3, 0x4C, 

    0x07, 0xFE, 0x23, 0x8D, 0xF4, 0x00, 0x03, 0xC7, 0xA4, 0x01, 0x62, 0x07, 0x61, 0x87, 0xE3, 0x4C, 
    0x07, 0xFE, 0x23, 0x8D, 0xF4, 0x00, 0x03, 0xC7, 0xA4, 0x01, 0x62, 0x07, 0x61, 0x87, 0xE3, 0x4C, 
    0x07, 0xFE, 0x23, 0x8D, 0xF4, 0x00, 0xFD, 0x19, 0x33, 0x04, 0xA9, 0x00, 0x63, 0x85, 0x09, 0x00, 
    0x93, 0x77, 0xF4, 0x0F, 0xCD, 0xF3, 0x21, 0x35, 0x49, 0xD5, 0x37, 0x17, 0x00, 0x40, 0x93, 0x07, 

    0x70, 0x05, 0x23, 0x00, 0xF7, 0x00, 0x93, 0x07, 0x80, 0xFA, 0x23, 0x00, 0xF7, 0x00, 0x83, 0x47, 
    0x47, 0x00, 0x93, 0xF7, 0x37, 0x07, 0x93, 0xE7, 0x07, 0x08, 0x23, 0x02, 0xF7, 0x00, 0xF2, 0x40, 
    0x62, 0x44, 0xD2, 0x44, 0x42, 0x49, 0xB2, 0x49, 0x05, 0x61, 0x82, 0x80, 0x01, 0x11, 0x4A, 0xC8, 
    0x21, 0x69, 0x26, 0xCA, 0x06, 0xCE, 0x22, 0xCC, 0x4E, 0xC6, 0x52, 0xC4, 0x2A, 0x99, 0xB7, 0x07, 

    0x08, 0x00, 0x93, 0x04, 0xE0, 0x0F, 0x63, 0x7C, 0xF9, 0x02, 0xB7, 0x17, 0x00, 0x40, 0x83, 0xC7, 
    0x47, 0x00, 0x93, 0x04, 0xB0, 0x0F, 0xC1, 0x8B, 0x9D, 0xE3, 0x2D, 0x45, 0x2E, 0x84, 0x93, 0x54, 
    0x26, 0x00, 0x21, 0x33, 0x4A, 0x85, 0xA9, 0x3B, 0x89, 0x33, 0x81, 0x33, 0xFD, 0x59, 0x37, 0x1A, 
    0x00, 0x40, 0x13, 0x89, 0xF4, 0xFF, 0x63, 0x1D, 0x39, 0x01, 0x81, 0x44, 0x09, 0x33, 0xF2, 0x40, 

    0x62, 0x44, 0x26, 0x85, 0x42, 0x49, 0xD2, 0x44, 0xB2, 0x49, 0x22, 0x4A, 0x05, 0x61, 0x82, 0x80, 
    0x29, 0x3B, 0x21, 0x3B, 0x19, 0x3B, 0x11, 0x3B, 0x11, 0x04, 0x03, 0x27, 0x4A, 0x01, 0x83, 0x27, 
    0xC4, 0xFF, 0xE3, 0x1D, 0xF7, 0xFC, 0xCA, 0x84, 0xE9, 0xB7, 0x01, 0x11, 0x22, 0xCC, 0x06, 0xCE, 
    0x37, 0x04, 0x28, 0x00, 0xE9, 0x31, 0x15, 0x45, 0x4D, 0x39, 0xC5, 0x39, 0xFD, 0x31, 0x2A, 0xC6, 

    0x7D, 0x39, 0x32, 0x45, 0x93, 0x77, 0x15, 0x00, 0x8D, 0xCB, 0x7D, 0x14, 0x6D, 0xF4, 0x13, 0x05, 
    0xF0, 0x0F, 0xF2, 0x40, 0x62, 0x44, 0x05, 0x61, 0x82, 0x80, 0x13, 0x07, 0x40, 0x04, 0x01, 0x45, 
    0xE3, 0x89, 0xE7, 0xFE, 0x05, 0x45, 0x01, 0x33, 0x13, 0x05, 0x40, 0x04, 0x65, 0x31, 0x09, 0x45, 
    0x55, 0x31, 0x62, 0x44, 0xF2, 0x40, 0x05, 0x61, 0x19, 0xB3, 0x93, 0x77, 0xC5, 0x07, 0xF1, 0xFF,

    0x01, 0x45, 0xC1, 0xBF, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};
uint8_t flash_op573[ ] ={
    0x79, 0x71, 0x22, 0xD4, 0x4A, 0xD0, 0x52, 0xCC, 0x06, 0xD6, 0x26, 0xD2, 0x4E, 0xCE, 0x56, 0xCA, 
    0x5A, 0xC8, 0x5E, 0xC6, 0x93, 0x77, 0x15, 0x00, 0x2A, 0x84, 0x2E, 0x8A, 0x32, 0x89, 0x9D, 0xEF, 
    0x93, 0x77, 0x24, 0x00, 0x99, 0xCB, 0xB7, 0x86, 0x07, 0x00, 0x01, 0x46, 0x81, 0x45, 0x05, 0x45, 
    0x69, 0x22, 0x93, 0x77, 0xF5, 0x0F, 0x09, 0x45, 0x9D, 0xEB, 0x93, 0x77, 0x44, 0x00, 0x91, 0xCB, 

    0x85, 0x66, 0x01, 0x46, 0xD2, 0x85, 0x05, 0x45, 0x8D, 0x2A, 0x93, 0x77, 0xF5, 0x0F, 0x11, 0x45, 
    0x99, 0xEF, 0x93, 0x77, 0x84, 0x01, 0x9D, 0xE7, 0x01, 0x45, 0x11, 0xA8, 0x81, 0x46, 0x01, 0x46, 
    0x81, 0x45, 0x21, 0x45, 0x99, 0x2A, 0x93, 0x77, 0xF5, 0x0F, 0x05, 0x45, 0xD5, 0xDB, 0xB2, 0x50, 
    0x22, 0x54, 0x92, 0x54, 0x02, 0x59, 0xF2, 0x49, 0x62, 0x4A, 0xD2, 0x4A, 0x42, 0x4B, 0xB2, 0x4B, 

    0x45, 0x61, 0x02, 0x90, 0xB7, 0x54, 0x00, 0x20, 0x13, 0x09, 0xF9, 0x0F, 0x93, 0x84, 0x04, 0x10, 
    0x93, 0x7B, 0x84, 0x00, 0x13, 0x59, 0x89, 0x00, 0x81, 0x4A, 0x33, 0x0A, 0x9A, 0x40, 0x41, 0x88, 
    0x33, 0x0B, 0x9A, 0x00, 0x63, 0x90, 0x0B, 0x02, 0x21, 0xC0, 0x93, 0x89, 0x04, 0xF0, 0x93, 0x06, 
    0x00, 0x10, 0x4E, 0x86, 0xDA, 0x85, 0x0D, 0x45, 0x09, 0x22, 0x13, 0x75, 0xF5, 0x0F, 0x19, 0xCD, 

    0x41, 0x45, 0x75, 0xB7, 0x93, 0x06, 0x00, 0x10, 0x13, 0x86, 0x04, 0xF0, 0xDA, 0x85, 0x09, 0x45, 
    0xED, 0x20, 0x13, 0x75, 0xF5, 0x0F, 0x69, 0xD9, 0x21, 0x45, 0x51, 0xBF, 0x83, 0xA7, 0x09, 0x00, 
    0x91, 0x09, 0xBE, 0x9A, 0xE3, 0x9C, 0x99, 0xFE, 0x7D, 0x19, 0x93, 0x84, 0x04, 0x10, 0xE3, 0x19, 
    0x09, 0xFA, 0x3D, 0xD0, 0xB7, 0x67, 0x00, 0x20, 0x9C, 0x4B, 0xE3, 0x8F, 0x57, 0xF5, 0xC9, 0xB7, 

    0x23, 0x03, 0x04, 0x80, 0x95, 0x47, 0x23, 0x03, 0xF4, 0x80, 0x23, 0x02, 0xA4, 0x80, 0x82, 0x80, 
    0x83, 0x07, 0x64, 0x80, 0xE3, 0xCE, 0x07, 0xFE, 0x23, 0x03, 0x04, 0x80, 0x82, 0x80, 0x83, 0x07, 
    0x64, 0x80, 0xE3, 0xCE, 0x07, 0xFE, 0x03, 0x45, 0x44, 0x80, 0x82, 0x80, 0x83, 0x07, 0x64, 0x80, 
    0xE3, 0xCE, 0x07, 0xFE, 0x23, 0x02, 0xA4, 0x80, 0x82, 0x80, 0x41, 0x11, 0x26, 0xC4, 0x4A, 0xC2, 

    0x4E, 0xC0, 0x06, 0xC6, 0x13, 0x77, 0xF5, 0x0B, 0xAD, 0x47, 0xAA, 0x89, 0x2E, 0x89, 0x95, 0x44, 
    0x63, 0x06, 0xF7, 0x00, 0x19, 0x45, 0x6D, 0x37, 0x65, 0x3F, 0x8D, 0x44, 0x4E, 0x85, 0x4D, 0x37, 
    0xFD, 0x59, 0xFD, 0x14, 0x63, 0x98, 0x34, 0x01, 0xB2, 0x40, 0xA2, 0x44, 0x12, 0x49, 0x82, 0x49, 
    0x41, 0x01, 0x82, 0x80, 0x13, 0x55, 0x09, 0x01, 0x13, 0x75, 0xF5, 0x0F, 0x45, 0x3F, 0x22, 0x09, 

    0xCD, 0xB7, 0x01, 0x11, 0x26, 0xCC, 0x06, 0xCE, 0xB7, 0x04, 0x08, 0x00, 0x51, 0x37, 0x15, 0x45, 
    0x85, 0x3F, 0x71, 0x37, 0x69, 0x37, 0x2A, 0xC6, 0xA5, 0x3F, 0x32, 0x45, 0x93, 0x77, 0x15, 0x00, 
    0x89, 0xEB, 0x13, 0x65, 0x15, 0x00, 0x13, 0x75, 0xF5, 0x0F, 0xF2, 0x40, 0xE2, 0x44, 0x05, 0x61, 
    0x82, 0x80, 0xFD, 0x14, 0xE9, 0xFC, 0x01, 0x45, 0xCD, 0xBF, 0x39, 0x71, 0x26, 0xDC, 0x4A, 0xDA, 

    0x4E, 0xD8, 0x52, 0xD6, 0x56, 0xD4, 0x5A, 0xD2, 0x5E, 0xD0, 0x06, 0xDE, 0x62, 0xCE, 0x66, 0xCC, 
    0xB7, 0xE7, 0x00, 0xE0, 0x7D, 0x57, 0x83, 0xAA, 0x07, 0x00, 0x22, 0xC6, 0x03, 0xAA, 0x47, 0x00, 
    0x23, 0xA0, 0xE7, 0x18, 0x23, 0xA2, 0xE7, 0x18, 0xB7, 0x17, 0x00, 0x40, 0x13, 0x07, 0x70, 0x05, 
    0x23, 0x80, 0xE7, 0x04, 0x13, 0x07, 0x80, 0xFA, 0x23, 0x80, 0xE7, 0x04, 0x83, 0xC7, 0x47, 0x04, 

    0x13, 0x09, 0x75, 0xFF, 0xB6, 0x84, 0xE2, 0x07, 0x13, 0x79, 0xF9, 0x0F, 0x85, 0x46, 0xAA, 0x89, 
    0xAE, 0x8B, 0x32, 0x8B, 0x37, 0x24, 0x00, 0x40, 0xE1, 0x87, 0x01, 0x57, 0x63, 0xFA, 0x26, 0x01, 
    0x63, 0x08, 0xD5, 0x00, 0x89, 0x46, 0x13, 0x07, 0x00, 0x02, 0x63, 0x13, 0xD5, 0x00, 0x01, 0x57, 
    0xD9, 0x8F, 0x93, 0xF7, 0xF7, 0x0F, 0xB7, 0x1C, 0x00, 0x40, 0x23, 0x82, 0xFC, 0x04, 0x11, 0x47, 

    0x23, 0x03, 0xE4, 0x80, 0x13, 0x05, 0xF0, 0x0F, 0x65, 0x3D, 0x09, 0x4C, 0xD1, 0x35, 0x63, 0x69, 
    0x2C, 0x11, 0xB7, 0x07, 0x07, 0x00, 0xBE, 0x9B, 0x37, 0x87, 0x07, 0x00, 0x79, 0x55, 0x63, 0xFE, 
    0xEB, 0x02, 0xB3, 0x87, 0x9B, 0x00, 0x63, 0x6A, 0xF7, 0x02, 0xA9, 0x47, 0x63, 0x99, 0xF9, 0x06, 
    0x89, 0xE4, 0x81, 0x44, 0x71, 0x3D, 0x26, 0x85, 0x0D, 0xA0, 0xDE, 0x85, 0x09, 0x45, 0x75, 0x3D, 

    0x05, 0x0B, 0x03, 0x45, 0xFB, 0xFF, 0xFD, 0x14, 0x85, 0x0B, 0x4D, 0x35, 0x81, 0xC4, 0x93, 0xF7, 
    0xFB, 0x0F, 0xFD, 0xF7, 0xFD, 0x35, 0x69, 0xFD, 0x7D, 0x55, 0xB7, 0x17, 0x00, 0x40, 0x13, 0x07, 
    0x70, 0x05, 0x23, 0x80, 0xE7, 0x04, 0x13, 0x07, 0x80, 0xFA, 0x23, 0x80, 0xE7, 0x04, 0x03, 0xC7, 
    0x47, 0x04, 0x41, 0x8B, 0x23, 0x82, 0xE7, 0x04, 0xF2, 0x50, 0xB7, 0xE7, 0x00, 0xE0, 0x23, 0xA0, 

    0x57, 0x11, 0x23, 0xA2, 0x47, 0x11, 0xE2, 0x54, 0x32, 0x44, 0x52, 0x59, 0xC2, 0x59, 0x32, 0x5A, 
    0xA2, 0x5A, 0x12, 0x5B, 0x82, 0x5B, 0x72, 0x4C, 0xE2, 0x4C, 0x21, 0x61, 0x82, 0x80, 0xA5, 0x47, 
    0x63, 0x95, 0xF9, 0x06, 0x85, 0x69, 0x13, 0x09, 0xF0, 0x0F, 0xB3, 0x06, 0x99, 0x00, 0xB3, 0xF4, 
    0x2B, 0x01, 0xB6, 0x94, 0x13, 0x49, 0xF9, 0xFF, 0xB3, 0x74, 0x99, 0x00, 0x41, 0x6B, 0x33, 0x79, 

    0x79, 0x01, 0x85, 0x6B, 0x93, 0x87, 0xF9, 0xFF, 0xB3, 0xF7, 0x27, 0x01, 0x99, 0xE3, 0x63, 0xFC, 
    0x34, 0x01, 0x93, 0xD9, 0x49, 0x00, 0xC1, 0x47, 0xE3, 0xE6, 0x37, 0xFF, 0x99, 0xBF, 0x05, 0x69, 
    0xC1, 0x69, 0x7D, 0x19, 0xD9, 0xB7, 0x13, 0x05, 0x80, 0x0D, 0x63, 0x88, 0x69, 0x01, 0x13, 0x05, 
    0x00, 0x02, 0x63, 0x84, 0x79, 0x01, 0x13, 0x05, 0x10, 0x08, 0xCA, 0x85, 0xFD, 0x3B, 0x91, 0x35, 

    0x21, 0xDD, 0x4E, 0x99, 0xB3, 0x84, 0x34, 0x41, 0xD9, 0xB7, 0xDE, 0x85, 0x2D, 0x45, 0xF5, 0x33, 
    0xDA, 0x94, 0xE3, 0x00, 0x9B, 0xF2, 0x05, 0x0B, 0xD9, 0x33, 0xA3, 0x0F, 0xAB, 0xFE, 0xD5, 0xBF, 
    0x93, 0x87, 0xF9, 0xFF, 0x93, 0xF7, 0xF7, 0x0F, 0x63, 0x6C, 0xFC, 0x08, 0x03, 0xC7, 0x5C, 0x04, 
    0xB7, 0x07, 0x08, 0x00, 0x13, 0x77, 0x07, 0x02, 0x19, 0xE3, 0xB7, 0x87, 0x07, 0x00, 0x79, 0x55, 

    0xE3, 0xFD, 0xFB, 0xF0, 0x33, 0x87, 0x9B, 0x00, 0xE3, 0xE9, 0xE7, 0xF0, 0x89, 0x47, 0x63, 0x90, 
    0xF9, 0x04, 0x89, 0x80, 0x55, 0x49, 0xE3, 0x8E, 0x04, 0xEC, 0xDE, 0x85, 0x09, 0x45, 0x71, 0x3B, 
    0x11, 0x0B, 0x03, 0x27, 0xCB, 0xFF, 0x91, 0x47, 0x23, 0x20, 0xE4, 0x80, 0x03, 0x07, 0x64, 0x80, 
    0xE3, 0x4E, 0x07, 0xFE, 0x23, 0x03, 0x24, 0x81, 0xFD, 0x17, 0xED, 0xFB, 0xFD, 0x14, 0x91, 0x0B, 

    0x81, 0xC4, 0x93, 0xF7, 0xFB, 0x0F, 0xE9, 0xFF, 0x6D, 0x3B, 0x71, 0xF5, 0xF1, 0xB5, 0x85, 0x47, 
    0xE3, 0x87, 0xF9, 0xF4, 0xDE, 0x85, 0x2D, 0x45, 0x8D, 0x33, 0x13, 0x89, 0xF4, 0xFF, 0xE3, 0x8A, 
    0x04, 0xE8, 0x35, 0x3B, 0x93, 0x77, 0x39, 0x00, 0x91, 0xEB, 0x83, 0x26, 0x04, 0x80, 0x03, 0x27, 
    0x0B, 0x00, 0x93, 0x07, 0x4B, 0x00, 0xE3, 0x9F, 0xE6, 0xE6, 0x3E, 0x8B, 0xCA, 0x84, 0xF1, 0xBF, 

    0xA1, 0x47, 0x63, 0x92, 0xF9, 0x04, 0xB5, 0x3B, 0x81, 0x44, 0x63, 0x8D, 0x0B, 0x00, 0x8D, 0x47, 
    0x93, 0x04, 0xC0, 0x03, 0x63, 0x88, 0xFB, 0x00, 0x93, 0x04, 0x00, 0x05, 0x63, 0x84, 0x8B, 0x01, 
    0x93, 0x04, 0x40, 0x04, 0x13, 0x75, 0xC5, 0x07, 0xE3, 0x05, 0x95, 0xE4, 0x19, 0x45, 0xC9, 0x39, 
    0xC5, 0x31, 0x05, 0x45, 0xF1, 0x31, 0x26, 0x85, 0xD5, 0x39, 0x09, 0x45, 0xC5, 0x39, 0x91, 0x33, 

    0xE3, 0x19, 0x05, 0xE2, 0x91, 0xBD, 0xE3, 0x86, 0x09, 0xE2, 0xF1, 0x54, 0x25, 0xB5, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};
uint8_t flash_op307[ ] ={
	0x01, 0x11, 0x02, 0xCE, 0x93, 0x77, 0x15, 0x00, 0x99, 0xCF, 0xB7, 0x06, 0x67, 0x45, 0xB7, 0x27, 
    0x02, 0x40, 0x93, 0x86, 0x36, 0x12, 0x37, 0x97, 0xEF, 0xCD, 0xD4, 0xC3, 0x13, 0x07, 0xB7, 0x9A, 
    0xD8, 0xC3, 0xD4, 0xD3, 0xD8, 0xD3, 0x93, 0x77, 0x25, 0x00, 0x95, 0xC7, 0xB7, 0x27, 0x02, 0x40, 
    0x98, 0x4B, 0xAD, 0x66, 0x37, 0x38, 0x00, 0x40, 0x13, 0x67, 0x47, 0x00, 0x98, 0xCB, 0x98, 0x4B,

    0x93, 0x86, 0xA6, 0xAA, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x61, 0xEB, 
    0x98, 0x4B, 0x6D, 0x9B, 0x98, 0xCB, 0x93, 0x77, 0x45, 0x00, 0xA9, 0xCB, 0x93, 0x07, 0xF6, 0x0F, 
    0xA1, 0x83, 0x2E, 0xC6, 0x2D, 0x68, 0x81, 0x76, 0x3E, 0xCA, 0xB7, 0x08, 0x02, 0x00, 0xB7, 0x27, 
    0x02, 0x40, 0x37, 0x33, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0xFD, 0x16, 0x98, 0x4B, 0x33, 0x67, 

    0x17, 0x01, 0x98, 0xCB, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 
    0xD8, 0x47, 0x05, 0x8B, 0x41, 0xEB, 0x98, 0x4B, 0x75, 0x8F, 0x98, 0xCB, 0x32, 0x47, 0x13, 0x07, 
    0x07, 0x10, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 0x69, 0xFB, 0x93, 0x77, 0x85, 0x00, 
    0xD5, 0xCB, 0x93, 0x07, 0xF6, 0x0F, 0x2E, 0xC6, 0xA1, 0x83, 0x3E, 0xCA, 0x37, 0x27, 0x02, 0x40, 

    0x1C, 0x4B, 0xC1, 0x66, 0x41, 0x68, 0xD5, 0x8F, 0x1C, 0xCB, 0xB7, 0x16, 0x00, 0x20, 0xB7, 0x27, 
    0x02, 0x40, 0x93, 0x08, 0x00, 0x04, 0x37, 0x03, 0x20, 0x00, 0x98, 0x4B, 0x33, 0x67, 0x07, 0x01, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x75, 0xFF, 0x32, 0x47, 0x3A, 0xC8, 0x46, 0xCC, 0x62, 0x47, 
    0x0D, 0xEF, 0x98, 0x4B, 0x33, 0x67, 0x67, 0x00, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x75, 0xFF, 

    0xD8, 0x47, 0x41, 0x8B, 0x39, 0xC3, 0xD8, 0x47, 0xC1, 0x76, 0xFD, 0x16, 0x13, 0x67, 0x07, 0x01, 
    0xD8, 0xC7, 0x98, 0x4B, 0x21, 0x45, 0x75, 0x8F, 0x98, 0xCB, 0x05, 0x61, 0x02, 0x90, 0x23, 0x20, 
    0xD8, 0x00, 0x25, 0xB7, 0x23, 0x20, 0x03, 0x01, 0xA5, 0xB7, 0x42, 0x47, 0x13, 0x8E, 0x46, 0x00, 
    0x94, 0x42, 0x14, 0xC3, 0x42, 0x47, 0x11, 0x07, 0x3A, 0xC8, 0x62, 0x47, 0x7D, 0x17, 0x3A, 0xCC, 

    0xD8, 0x47, 0x09, 0x8B, 0x75, 0xFF, 0xF2, 0x86, 0x5D, 0xB7, 0x32, 0x47, 0x13, 0x07, 0x07, 0x10, 
    0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 0x49, 0xF3, 0x98, 0x4B, 0xC1, 0x76, 0xFD, 0x16, 
    0x75, 0x8F, 0x98, 0xCB, 0x41, 0x89, 0x19, 0xE1, 0x01, 0x45, 0x45, 0xBF, 0x2E, 0xC6, 0x0D, 0x06, 
    0x02, 0xCA, 0x09, 0x82, 0x32, 0xCC, 0xB7, 0x17, 0x00, 0x20, 0x98, 0x43, 0x13, 0x86, 0x47, 0x00, 

    0xD2, 0x47, 0xB2, 0x46, 0x8A, 0x07, 0xB6, 0x97, 0x9C, 0x43, 0x63, 0x18, 0xF7, 0x02, 0xD2, 0x47, 
    0x32, 0x47, 0x8A, 0x07, 0xBA, 0x97, 0x98, 0x43, 0xF2, 0x47, 0xBA, 0x97, 0x3E, 0xCE, 0xD2, 0x47, 
    0x85, 0x07, 0x3E, 0xCA, 0xD2, 0x46, 0x62, 0x47, 0xB2, 0x87, 0xE3, 0xE8, 0xE6, 0xFC, 0xB7, 0x27, 
    0x00, 0x20, 0x98, 0x4B, 0xF2, 0x47, 0xE3, 0x09, 0xF7, 0xFA, 0x41, 0x45, 0xB9, 0xBF, 0xff, 0xff,

	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};

uint8_t flash_op003[ ] ={//v003
    0x11, 0x11, 0x22, 0xCC, 0x26, 0xCA, 0x02, 0xC8, 0x93, 0x77, 0x15, 0x00, 0x99, 0xCF, 0xB7, 0x06, 
    0x67, 0x45, 0xB7, 0x27, 0x02, 0x40, 0x93, 0x86, 0x36, 0x12, 0x37, 0x97, 0xEF, 0xCD, 0xD4, 0xC3, 
    0x13, 0x07, 0xB7, 0x9A, 0xD8, 0xC3, 0xD4, 0xD3, 0xD8, 0xD3, 0x93, 0x77, 0x25, 0x00, 0x9D, 0xC7, 
    0xB7, 0x27, 0x02, 0x40, 0x98, 0x4B, 0xAD, 0x66, 0x37, 0x33, 0x00, 0x40, 0x13, 0x67, 0x47, 0x00, 

    0x98, 0xCB, 0x98, 0x4B, 0x93, 0x86, 0xA6, 0xAA, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 
    0x05, 0x8B, 0x63, 0x16, 0x07, 0x10, 0x98, 0x4B, 0x6D, 0x9B, 0x98, 0xCB, 0x93, 0x77, 0x45, 0x00, 
    0xA9, 0xCB, 0x93, 0x07, 0xF6, 0x03, 0x99, 0x83, 0x2E, 0xC0, 0x2D, 0x63, 0x81, 0x76, 0x3E, 0xC4, 
    0xB7, 0x32, 0x00, 0x40, 0xB7, 0x27, 0x02, 0x40, 0x13, 0x03, 0xA3, 0xAA, 0xFD, 0x16, 0x98, 0x4B, 

    0xB7, 0x03, 0x02, 0x00, 0x33, 0x67, 0x77, 0x00, 0x98, 0xCB, 0x02, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 
    0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x69, 0xE7, 0x98, 0x4B, 0x75, 0x8F, 
    0x98, 0xCB, 0x02, 0x47, 0x13, 0x07, 0x07, 0x04, 0x3A, 0xC0, 0x22, 0x47, 0x7D, 0x17, 0x3A, 0xC4, 
    0x79, 0xF7, 0x93, 0x77, 0x85, 0x00, 0xF1, 0xCF, 0x93, 0x07, 0xF6, 0x03, 0x2E, 0xC0, 0x99, 0x83, 

    0x37, 0x27, 0x02, 0x40, 0x3E, 0xC4, 0x1C, 0x4B, 0xC1, 0x66, 0x2D, 0x63, 0xD5, 0x8F, 0x1C, 0xCB, 
    0x37, 0x07, 0x00, 0x20, 0x13, 0x07, 0x07, 0x20, 0xB7, 0x27, 0x02, 0x40, 0xB7, 0x03, 0x08, 0x00, 
    0xB7, 0x32, 0x00, 0x40, 0x13, 0x03, 0xA3, 0xAA, 0x94, 0x4B, 0xB3, 0xE6, 0x76, 0x00, 0x94, 0xCB, 
    0xD4, 0x47, 0x85, 0x8A, 0xF5, 0xFE, 0x82, 0x46, 0xBA, 0x84, 0x37, 0x04, 0x04, 0x00, 0x36, 0xC2, 

    0xC1, 0x46, 0x36, 0xC6, 0x92, 0x46, 0x84, 0x40, 0x11, 0x07, 0x84, 0xC2, 0x94, 0x4B, 0xC1, 0x8E, 
    0x94, 0xCB, 0xD4, 0x47, 0x85, 0x8A, 0xB1, 0xEA, 0x92, 0x46, 0xBA, 0x84, 0x91, 0x06, 0x36, 0xC2, 
    0xB2, 0x46, 0xFD, 0x16, 0x36, 0xC6, 0xF9, 0xFE, 0x82, 0x46, 0xD4, 0xCB, 0x94, 0x4B, 0x93, 0xE6, 
    0x06, 0x04, 0x94, 0xCB, 0xD4, 0x47, 0x85, 0x8A, 0x85, 0xEE, 0xD4, 0x47, 0xC1, 0x8A, 0x85, 0xCE, 

    0xD8, 0x47, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x13, 0x67, 0x07, 0x01, 0xD8, 0xC7, 0x98, 0x4B, 
    0x21, 0x45, 0x75, 0x8F, 0x98, 0xCB, 0x62, 0x44, 0xD2, 0x44, 0x71, 0x01, 0x02, 0x90, 0x23, 0x20, 
    0xD3, 0x00, 0xF5, 0xB5, 0x23, 0xA0, 0x62, 0x00, 0x3D, 0xB7, 0x23, 0xA0, 0x62, 0x00, 0x55, 0xB7, 
    0x23, 0xA0, 0x62, 0x00, 0xC1, 0xB7, 0x82, 0x46, 0x93, 0x86, 0x06, 0x04, 0x36, 0xC0, 0xA2, 0x46, 

    0xFD, 0x16, 0x36, 0xC4, 0xB5, 0xF2, 0x98, 0x4B, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x75, 0x8F, 
    0x98, 0xCB, 0x41, 0x89, 0x19, 0xE1, 0x01, 0x45, 0x7D, 0xBF, 0x2E, 0xC0, 0x0D, 0x06, 0x02, 0xC4, 
    0x09, 0x82, 0xB7, 0x07, 0x00, 0x20, 0x32, 0xC6, 0x93, 0x87, 0x07, 0x20, 0x94, 0x43, 0x13, 0x87, 
    0x47, 0x00, 0xA2, 0x47, 0x02, 0x46, 0x8A, 0x07, 0xB2, 0x97, 0x9C, 0x43, 0x63, 0x99, 0xF6, 0x02, 

    0xA2, 0x47, 0x82, 0x46, 0x8A, 0x07, 0xB6, 0x97, 0x94, 0x43, 0xC2, 0x47, 0xB6, 0x97, 0x3E, 0xC8, 
    0xA2, 0x47, 0x85, 0x07, 0x3E, 0xC4, 0x22, 0x46, 0xB2, 0x46, 0xBA, 0x87, 0xE3, 0x68, 0xD6, 0xFC, 
    0xB7, 0x07, 0x00, 0x20, 0x03, 0xA7, 0x07, 0x61, 0xC2, 0x47, 0xE3, 0x06, 0xF7, 0xFA, 0x41, 0x45, 
    0x9D, 0xB7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};
uint8_t flash_op8571[ ]={//CH8571
    0x01, 0x11, 0x22, 0xCE, 0x26, 0xCC, 0x2E, 0xC0, 0x32, 0xC2, 0x93, 0x77, 0x25, 0x00, 0x63, 0x8D, 
    0x07, 0x22, 0xB7, 0x17, 0x00, 0x40, 0x83, 0xC7, 0x07, 0x08, 0x9D, 0x8B, 0x3E, 0xCA, 0xD2, 0x47, 
    0x63, 0x9C, 0x07, 0x4A, 0x85, 0x47, 0x3E, 0xC8, 0xB7, 0x17, 0x00, 0x40, 0x02, 0xC4, 0x93, 0x04, 
    0xF0, 0x04, 0x93, 0x82, 0xD7, 0x03, 0xFD, 0x53, 0x7D, 0x53, 0x79, 0x56, 0xF5, 0x55, 0x15, 0x44, 

    0x23, 0x8F, 0x97, 0x02, 0x23, 0x80, 0x62, 0x00, 0xA3, 0x8D, 0x07, 0x02, 0x23, 0x8E, 0xC7, 0x02, 
    0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x19, 0x47, 0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 
    0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 0x83, 0xC6, 
    0xF7, 0x03, 0x85, 0x8A, 0xED, 0xFE, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 

    0xB7, 0x02, 0x93, 0x06, 0x80, 0xFD, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xC1, 0x82, 0x93, 0xF6, 
    0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xA1, 0x82, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 
    0xD7, 0x02, 0xA2, 0x46, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 
    0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 0x03, 0xC7, 0xF7, 0x03, 

    0x05, 0x8B, 0x6D, 0xFF, 0x23, 0x8F, 0x07, 0x02, 0x23, 0x80, 0x02, 0x00, 0x22, 0x47, 0xC1, 0x66, 
    0x36, 0x97, 0x3A, 0xC4, 0x42, 0x47, 0x7D, 0x17, 0x3A, 0xC8, 0x3D, 0xF3, 0x85, 0x47, 0x3E, 0xC8, 
    0xB7, 0x17, 0x00, 0x40, 0x93, 0x04, 0xF0, 0x04, 0x93, 0x82, 0xD7, 0x03, 0xFD, 0x53, 0x7D, 0x53, 
    0x79, 0x56, 0xF5, 0x55, 0x15, 0x44, 0x23, 0x8F, 0x97, 0x02, 0x23, 0x80, 0x62, 0x00, 0xA3, 0x8D, 

    0x07, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x19, 0x47, 
    0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 
    0xA3, 0x8F, 0x87, 0x02, 0x83, 0xC6, 0xF7, 0x03, 0x85, 0x8A, 0xED, 0xFE, 0x23, 0x8E, 0xC7, 0x02, 
    0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x93, 0x06, 0x20, 0x05, 0xA3, 0x8F, 0xD7, 0x02, 

    0xA2, 0x46, 0xC1, 0x82, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xA1, 0x82, 
    0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 
    0xD7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 
    0x87, 0x02, 0x03, 0xC7, 0xF7, 0x03, 0x05, 0x8B, 0x6D, 0xFF, 0x23, 0x8F, 0x07, 0x02, 0x23, 0x80, 

    0x02, 0x00, 0x22, 0x47, 0xA1, 0x66, 0x36, 0x97, 0x3A, 0xC4, 0x42, 0x47, 0x7D, 0x17, 0x3A, 0xC8, 
    0x3D, 0xF3, 0x99, 0x47, 0x3E, 0xC8, 0xB7, 0x17, 0x00, 0x40, 0x93, 0x04, 0xF0, 0x04, 0x93, 0x82, 
    0xD7, 0x03, 0xFD, 0x53, 0x7D, 0x53, 0x79, 0x56, 0xF5, 0x55, 0x15, 0x44, 0x23, 0x8F, 0x97, 0x02, 
    0x23, 0x80, 0x62, 0x00, 0xA3, 0x8D, 0x07, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 

    0x23, 0x8E, 0xB7, 0x02, 0x19, 0x47, 0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 
    0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 0x83, 0xC6, 0xF7, 0x03, 0x85, 0x8A, 
    0xED, 0xFE, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x93, 0x06, 
    0x00, 0x02, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xC1, 0x82, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 

    0xD7, 0x02, 0xA2, 0x46, 0xA1, 0x82, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 
    0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 
    0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 0x03, 0xC7, 0xF7, 0x03, 0x05, 0x8B, 0x6D, 0xFF, 
    0x23, 0x8F, 0x07, 0x02, 0x23, 0x80, 0x02, 0x00, 0x22, 0x47, 0x85, 0x66, 0x36, 0x97, 0x3A, 0xC4, 

    0x42, 0x47, 0x7D, 0x17, 0x3A, 0xC8, 0x3D, 0xF3, 0x93, 0x77, 0x45, 0x00, 0xE9, 0xC3, 0x82, 0x47, 
    0x93, 0x04, 0xF0, 0x04, 0xFD, 0x53, 0x3E, 0xC4, 0x92, 0x47, 0x7D, 0x53, 0x79, 0x56, 0x93, 0x87, 
    0xF7, 0x0F, 0xA1, 0x83, 0x3E, 0xC6, 0xB7, 0x17, 0x00, 0x40, 0x93, 0x82, 0xD7, 0x03, 0xF5, 0x55, 
    0x15, 0x44, 0x23, 0x8F, 0x97, 0x02, 0x23, 0x80, 0x62, 0x00, 0xA3, 0x8D, 0x07, 0x02, 0x23, 0x8E, 

    0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x19, 0x47, 0xA3, 0x8F, 0xE7, 0x02, 
    0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x67, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 
    0x83, 0xC6, 0xF7, 0x03, 0x85, 0x8A, 0xED, 0xFE, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 
    0x23, 0x8E, 0xB7, 0x02, 0x93, 0x06, 0x10, 0xF8, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xC1, 0x82, 

    0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0xA1, 0x82, 0x93, 0xF6, 0xF6, 0x0F, 
    0xA3, 0x8F, 0xD7, 0x02, 0xA2, 0x46, 0x93, 0xF6, 0xF6, 0x0F, 0xA3, 0x8F, 0xD7, 0x02, 0x23, 0x8E, 
    0xC7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0xA3, 0x8F, 0x87, 0x02, 0x03, 0xC7, 
    0xF7, 0x03, 0x05, 0x8B, 0x6D, 0xFF, 0x23, 0x8F, 0x07, 0x02, 0x23, 0x80, 0x02, 0x00, 0x22, 0x47, 

    0x13, 0x07, 0x07, 0x10, 0x3A, 0xC4, 0x32, 0x47, 0x7D, 0x17, 0x3A, 0xC6, 0x3D, 0xF3, 0x93, 0x77, 
    0x85, 0x00, 0xF5, 0xCF, 0x02, 0xCA, 0xB7, 0x27, 0x00, 0x40, 0x83, 0xC7, 0x27, 0x00, 0xBD, 0x8B, 
    0x99, 0xEF, 0x37, 0x57, 0x00, 0x40, 0x83, 0x47, 0x77, 0x00, 0xE2, 0x07, 0xE1, 0x87, 0x63, 0xD8, 
    0x07, 0x00, 0x93, 0x07, 0xA0, 0xFA, 0xA3, 0x02, 0xF7, 0x00, 0x85, 0x47, 0x3E, 0xCA, 0x82, 0x47, 

    0x37, 0x17, 0x00, 0x20, 0xFD, 0x53, 0x3E, 0xC4, 0x92, 0x47, 0xFD, 0x55, 0xF9, 0x56, 0x93, 0x87, 
    0xF7, 0x0F, 0xA1, 0x83, 0x3E, 0xC6, 0xB7, 0x17, 0x00, 0x40, 0x93, 0x82, 0xD7, 0x03, 0x75, 0x56, 
    0x19, 0x44, 0x93, 0x04, 0xF0, 0x04, 0x23, 0x8F, 0x97, 0x02, 0x23, 0x80, 0xB2, 0x00, 0xA3, 0x8D, 
    0x07, 0x02, 0x23, 0x8E, 0xD7, 0x02, 0xA3, 0x8F, 0xB7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 

    0x87, 0x02, 0x23, 0x8E, 0xD7, 0x02, 0xA3, 0x8F, 0xB7, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0x09, 0x43, 
    0xA3, 0x8F, 0x67, 0x02, 0x22, 0x43, 0x93, 0x04, 0xF0, 0x0F, 0x13, 0x53, 0x03, 0x01, 0x13, 0x73, 
    0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 0x22, 0x43, 0x13, 0x53, 0x83, 0x00, 0x13, 0x73, 0xF3, 0x0F, 
    0xA3, 0x8F, 0x67, 0x02, 0x22, 0x43, 0x13, 0x73, 0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 0x02, 0xC8, 

    0x42, 0x43, 0x63, 0xFD, 0x64, 0x12, 0x23, 0x8E, 0xD7, 0x02, 0xA3, 0x8F, 0x77, 0x02, 0x23, 0x8E, 
    0xC7, 0x02, 0x15, 0x43, 0xA3, 0x8F, 0x67, 0x02, 0x03, 0xC3, 0xF7, 0x03, 0x13, 0x73, 0x13, 0x00, 
    0xE3, 0x1C, 0x03, 0xFE, 0x23, 0x8F, 0x07, 0x02, 0x23, 0x80, 0x02, 0x00, 0x22, 0x43, 0x13, 0x03, 
    0x03, 0x10, 0x1A, 0xC4, 0x32, 0x43, 0x7D, 0x13, 0x1A, 0xC6, 0xE3, 0x14, 0x03, 0xF6, 0xD2, 0x47, 

    0x99, 0xC7, 0xB7, 0x57, 0x00, 0x40, 0x13, 0x07, 0x50, 0x05, 0x23, 0x83, 0xE7, 0x00, 0x41, 0x89, 
    0x71, 0xC1, 0x82, 0x47, 0xB7, 0x16, 0x00, 0x20, 0x93, 0x02, 0xF0, 0x04, 0x3E, 0xC4, 0x92, 0x47, 
    0x7D, 0x57, 0xF5, 0x55, 0x13, 0x86, 0xF7, 0x0F, 0x21, 0x82, 0xB7, 0x17, 0x00, 0x40, 0x32, 0xC6, 
    0x13, 0x85, 0xE7, 0x03, 0x79, 0x56, 0x23, 0x00, 0x55, 0x00, 0xA3, 0x8E, 0xE7, 0x02, 0xA3, 0x8D, 

    0x07, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x19, 0x44, 
    0xA3, 0x8F, 0x87, 0x02, 0x23, 0x8E, 0xC7, 0x02, 0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 0xB7, 0x02, 
    0x2D, 0x44, 0xA3, 0x8F, 0x87, 0x02, 0x22, 0x43, 0x93, 0x03, 0xF0, 0x0F, 0x13, 0x53, 0x03, 0x01, 
    0x13, 0x73, 0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 0x22, 0x43, 0x13, 0x53, 0x83, 0x00, 0x13, 0x73, 

    0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 0x22, 0x43, 0x13, 0x73, 0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 
    0xA3, 0x8F, 0x07, 0x02, 0x02, 0xC8, 0x42, 0x43, 0x63, 0xFD, 0x63, 0x06, 0x23, 0x8E, 0xC7, 0x02, 
    0xA3, 0x8F, 0xE7, 0x02, 0x23, 0x8E, 0xB7, 0x02, 0x15, 0x43, 0xA3, 0x8F, 0x67, 0x02, 0x03, 0xC3, 
    0xF7, 0x03, 0x13, 0x73, 0x13, 0x00, 0xE3, 0x1C, 0x03, 0xFE, 0x23, 0x00, 0x05, 0x00, 0xA3, 0x8E, 

    0x07, 0x02, 0x22, 0x43, 0x13, 0x03, 0x03, 0x10, 0x1A, 0xC4, 0x32, 0x43, 0x7D, 0x13, 0x1A, 0xC6, 
    0xE3, 0x13, 0x03, 0xF6, 0x01, 0x45, 0x49, 0xA0, 0x52, 0x47, 0x85, 0x47, 0x63, 0x14, 0xF7, 0x00, 
    0x8D, 0x47, 0x91, 0xB6, 0x52, 0x47, 0x89, 0x47, 0x63, 0x14, 0xF7, 0x00, 0x9D, 0x47, 0x25, 0xBE, 
    0x52, 0x47, 0x8D, 0x47, 0xE3, 0x1A, 0xF7, 0xB2, 0xBD, 0x47, 0x35, 0xB6, 0x03, 0x43, 0x07, 0x00, 

    0x05, 0x07, 0x13, 0x73, 0xF3, 0x0F, 0xA3, 0x8F, 0x67, 0x02, 0x42, 0x43, 0x05, 0x03, 0x1A, 0xC8, 
    0x45, 0xBD, 0x83, 0xC4, 0xF7, 0x03, 0x13, 0x84, 0x16, 0x00, 0x83, 0xC6, 0x06, 0x00, 0x13, 0x83, 
    0xF7, 0x03, 0x93, 0xF6, 0xF6, 0x0F, 0x63, 0x8D, 0x96, 0x02, 0x79, 0x57, 0x23, 0x8E, 0xE7, 0x02, 
    0x7D, 0x57, 0xA3, 0x8F, 0xE7, 0x02, 0x75, 0x57, 0x23, 0x8E, 0xE7, 0x02, 0x95, 0x47, 0x23, 0x00, 

    0xF3, 0x00, 0xB7, 0x17, 0x00, 0x40, 0x03, 0xC7, 0xF7, 0x03, 0x05, 0x8B, 0x6D, 0xFF, 0x23, 0x8F, 
    0x07, 0x02, 0xA3, 0x8E, 0x07, 0x02, 0x41, 0x45, 0x72, 0x44, 0xE2, 0x44, 0x05, 0x61, 0x02, 0x90, 
    0xC2, 0x46, 0x85, 0x06, 0x36, 0xC8, 0xA2, 0x86, 0x3D, 0xB7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,

};
uint8_t flash_op643[ ] =  /* CH64x */
{
    0x01, 0x11, 0x02, 0xCE, 0x93, 0x77, 0x15, 0x00, 0x99, 0xCF, 0xB7, 0x06, 0x67, 0x45, 0xB7, 0x27, 
    0x02, 0x40, 0x93, 0x86, 0x36, 0x12, 0x37, 0x97, 0xEF, 0xCD, 0xD4, 0xC3, 0x13, 0x07, 0xB7, 0x9A, 
    0xD8, 0xC3, 0xD4, 0xD3, 0xD8, 0xD3, 0x93, 0x77, 0x25, 0x00, 0x9D, 0xC7, 0xB7, 0x27, 0x02, 0x40, 
    0x98, 0x4B, 0xAD, 0x66, 0x37, 0x38, 0x00, 0x40, 0x13, 0x67, 0x47, 0x00, 0x98, 0xCB, 0x98, 0x4B, 

    0x93, 0x86, 0xA6, 0xAA, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x63, 0x16, 
    0x07, 0x10, 0x98, 0x4B, 0x6D, 0x9B, 0x98, 0xCB, 0x93, 0x77, 0x45, 0x00, 0xA9, 0xCB, 0x93, 0x07, 
    0xF6, 0x0F, 0xA1, 0x83, 0x2E, 0xC6, 0x2D, 0x68, 0x81, 0x76, 0x3E, 0xCA, 0xB7, 0x08, 0x02, 0x00, 
    0xB7, 0x27, 0x02, 0x40, 0x37, 0x33, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0xFD, 0x16, 0x98, 0x4B, 

    0x33, 0x67, 0x17, 0x01, 0x98, 0xCB, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 0x07, 0x04, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x69, 0xE7, 0x98, 0x4B, 0x75, 0x8F, 0x98, 0xCB, 0x32, 0x47, 
    0x13, 0x07, 0x07, 0x10, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 0x69, 0xFB, 0x93, 0x77, 
    0x85, 0x00, 0xF1, 0xCF, 0x93, 0x07, 0xF6, 0x0F, 0x2E, 0xC6, 0xA1, 0x83, 0x3E, 0xCA, 0x37, 0x27, 

    0x02, 0x40, 0x1C, 0x4B, 0xC1, 0x66, 0x2D, 0x68, 0xD5, 0x8F, 0x1C, 0xCB, 0xB7, 0x16, 0x00, 0x20, 
    0xB7, 0x27, 0x02, 0x40, 0x37, 0x03, 0x08, 0x00, 0x13, 0x0E, 0x00, 0x04, 0xB7, 0x0E, 0x04, 0x00, 
    0xB7, 0x38, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0x98, 0x4B, 0x33, 0x67, 0x67, 0x00, 0x98, 0xCB, 
    0xD8, 0x47, 0x05, 0x8B, 0x75, 0xFF, 0x32, 0x47, 0x36, 0x8F, 0x3A, 0xC8, 0x72, 0xCC, 0x42, 0x47, 

    0x03, 0x2F, 0x0F, 0x00, 0x91, 0x06, 0x23, 0x20, 0xE7, 0x01, 0x98, 0x4B, 0x33, 0x67, 0xD7, 0x01, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x21, 0xEB, 0x42, 0x47, 0x36, 0x8F, 0x11, 0x07, 0x3A, 0xC8, 
    0x62, 0x47, 0x7D, 0x17, 0x3A, 0xCC, 0x61, 0xFF, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 
    0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x15, 0xEB, 0xD8, 0x47, 0x41, 0x8B, 0x15, 0xCB, 

    0xD8, 0x47, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x13, 0x67, 0x07, 0x01, 0xD8, 0xC7, 0x98, 0x4B, 
    0x21, 0x45, 0x75, 0x8F, 0x98, 0xCB, 0x05, 0x61, 0x02, 0x90, 0x23, 0x20, 0xD8, 0x00, 0xF5, 0xB5, 
    0x23, 0x20, 0x03, 0x01, 0x3D, 0xB7, 0x23, 0xA0, 0x08, 0x01, 0x65, 0xB7, 0x23, 0xA0, 0x08, 0x01, 
    0xD1, 0xB7, 0x32, 0x47, 0x13, 0x07, 0x07, 0x10, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 

    0x25, 0xF7, 0x98, 0x4B, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x75, 0x8F, 0x98, 0xCB, 0x41, 0x89, 
    0x19, 0xE1, 0x01, 0x45, 0xC9, 0xB7, 0x2E, 0xC6, 0x0D, 0x06, 0x02, 0xCA, 0x09, 0x82, 0x32, 0xCC, 
    0xB7, 0x17, 0x00, 0x20, 0x98, 0x43, 0x13, 0x86, 0x47, 0x00, 0xD2, 0x47, 0xB2, 0x46, 0x8A, 0x07, 
    0xB6, 0x97, 0x9C, 0x43, 0x63, 0x18, 0xF7, 0x02, 0xD2, 0x47, 0x32, 0x47, 0x8A, 0x07, 0xBA, 0x97, 

    0x98, 0x43, 0xF2, 0x47, 0xBA, 0x97, 0x3E, 0xCE, 0xD2, 0x47, 0x85, 0x07, 0x3E, 0xCA, 0xD2, 0x46, 
    0x62, 0x47, 0xB2, 0x87, 0xE3, 0xE8, 0xE6, 0xFC, 0xB7, 0x27, 0x00, 0x20, 0x98, 0x4B, 0xF2, 0x47, 
    0xE3, 0x09, 0xF7, 0xFA, 0x41, 0x45, 0x85, 0xBF, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};

uint8_t flash_op583[ ]={
    0x79, 0x71, 0x22, 0xD4, 0x4A, 0xD0, 0x56, 0xCA, 0x06, 0xD6, 0x26, 0xD2, 0x4E, 0xCE, 0x52, 0xCC, 
    0x5A, 0xC8, 0x5E, 0xC6, 0x62, 0xC4, 0x93, 0x77, 0x15, 0x00, 0x2A, 0x84, 0xAE, 0x8A, 0x32, 0x89, 
    0xC1, 0xE3, 0x93, 0x77, 0x24, 0x00, 0x99, 0xCB, 0xB7, 0x86, 0x07, 0x00, 0x01, 0x46, 0x81, 0x45, 
    0x05, 0x45, 0x49, 0x2A, 0x93, 0x77, 0xF5, 0x0F, 0x09, 0x45, 0xA5, 0xEF, 0x93, 0x77, 0x44, 0x00, 

    0x91, 0xCB, 0x85, 0x66, 0x01, 0x46, 0xD6, 0x85, 0x05, 0x45, 0xAD, 0x2A, 0x93, 0x77, 0xF5, 0x0F, 
    0x11, 0x45, 0xA5, 0xE3, 0x93, 0x77, 0x84, 0x01, 0x01, 0x4A, 0xD9, 0xCF, 0xB7, 0x54, 0x00, 0x20, 
    0x13, 0x09, 0xF9, 0x0F, 0x93, 0x84, 0x04, 0x10, 0x13, 0x59, 0x89, 0x00, 0x01, 0x4A, 0xB3, 0x8A, 
    0x9A, 0x40, 0x93, 0x7B, 0x84, 0x00, 0x13, 0x7C, 0x04, 0x01, 0x33, 0x8B, 0x9A, 0x00, 0x63, 0x96, 

    0x0B, 0x04, 0x63, 0x06, 0x0C, 0x06, 0x93, 0x89, 0x04, 0xF0, 0x93, 0x06, 0x00, 0x10, 0x4E, 0x86, 
    0xDA, 0x85, 0x0D, 0x45, 0x05, 0x2A, 0x13, 0x75, 0xF5, 0x0F, 0x21, 0xC5, 0x41, 0x45, 0x11, 0xA8, 
    0x81, 0x46, 0x01, 0x46, 0x81, 0x45, 0x21, 0x45, 0x31, 0x2A, 0x93, 0x77, 0xF5, 0x0F, 0x05, 0x45, 
    0xAD, 0xDB, 0xB2, 0x50, 0x22, 0x54, 0x92, 0x54, 0x02, 0x59, 0xF2, 0x49, 0x62, 0x4A, 0xD2, 0x4A, 

    0x42, 0x4B, 0xB2, 0x4B, 0x22, 0x4C, 0x45, 0x61, 0x02, 0x90, 0x93, 0x06, 0x00, 0x10, 0x13, 0x86, 
    0x04, 0xF0, 0xDA, 0x85, 0x09, 0x45, 0xFD, 0x20, 0x13, 0x75, 0xF5, 0x0F, 0x5D, 0xD1, 0x21, 0x45, 
    0xC9, 0xBF, 0x83, 0xA7, 0x09, 0x00, 0x91, 0x09, 0x3E, 0x9A, 0xE3, 0x9C, 0x34, 0xFF, 0x7D, 0x19, 
    0x93, 0x84, 0x04, 0x10, 0xE3, 0x13, 0x09, 0xF8, 0x41, 0x88, 0x01, 0x45, 0x5D, 0xD8, 0xB7, 0x67, 

    0x00, 0x20, 0x9C, 0x4B, 0xE3, 0x87, 0x47, 0xFB, 0x51, 0xBF, 0x23, 0x03, 0x04, 0x80, 0x95, 0x47, 
    0x23, 0x03, 0xF4, 0x80, 0x23, 0x02, 0xA4, 0x80, 0x82, 0x80, 0x83, 0x07, 0x64, 0x80, 0xE3, 0xCE, 
    0x07, 0xFE, 0x23, 0x03, 0x04, 0x80, 0x82, 0x80, 0x83, 0x07, 0x64, 0x80, 0xE3, 0xCE, 0x07, 0xFE, 
    0x03, 0x45, 0x44, 0x80, 0x82, 0x80, 0x83, 0x07, 0x64, 0x80, 0xE3, 0xCE, 0x07, 0xFE, 0x23, 0x02, 

    0xA4, 0x80, 0x82, 0x80, 0x41, 0x11, 0x26, 0xC4, 0x4A, 0xC2, 0x4E, 0xC0, 0x06, 0xC6, 0x13, 0x77, 
    0xF5, 0x0B, 0xAD, 0x47, 0xAA, 0x89, 0x2E, 0x89, 0x95, 0x44, 0x63, 0x06, 0xF7, 0x00, 0x19, 0x45, 
    0x6D, 0x37, 0x65, 0x3F, 0x8D, 0x44, 0x4E, 0x85, 0x4D, 0x37, 0xFD, 0x59, 0xFD, 0x14, 0x63, 0x98, 
    0x34, 0x01, 0xB2, 0x40, 0xA2, 0x44, 0x12, 0x49, 0x82, 0x49, 0x41, 0x01, 0x82, 0x80, 0x13, 0x55, 

    0x09, 0x01, 0x13, 0x75, 0xF5, 0x0F, 0x45, 0x3F, 0x22, 0x09, 0xCD, 0xB7, 0x01, 0x11, 0x26, 0xCC, 
    0x06, 0xCE, 0xB7, 0x04, 0x08, 0x00, 0x51, 0x37, 0x15, 0x45, 0x85, 0x3F, 0x71, 0x37, 0x69, 0x37, 
    0x2A, 0xC6, 0xA5, 0x3F, 0x32, 0x45, 0x93, 0x77, 0x15, 0x00, 0x89, 0xEB, 0x13, 0x65, 0x15, 0x00, 
    0x13, 0x75, 0xF5, 0x0F, 0xF2, 0x40, 0xE2, 0x44, 0x05, 0x61, 0x82, 0x80, 0xFD, 0x14, 0xE9, 0xFC, 

    0x01, 0x45, 0xCD, 0xBF, 0x39, 0x71, 0x26, 0xDC, 0x4A, 0xDA, 0x4E, 0xD8, 0x52, 0xD6, 0x56, 0xD4, 
    0x5A, 0xD2, 0x5E, 0xD0, 0x06, 0xDE, 0x62, 0xCE, 0x66, 0xCC, 0xB7, 0xE7, 0x00, 0xE0, 0x7D, 0x57, 
    0x83, 0xAA, 0x07, 0x00, 0x22, 0xC6, 0x03, 0xAA, 0x47, 0x00, 0x23, 0xA0, 0xE7, 0x18, 0x23, 0xA2, 
    0xE7, 0x18, 0xB7, 0x17, 0x00, 0x40, 0x13, 0x07, 0x70, 0x05, 0x23, 0x80, 0xE7, 0x04, 0x13, 0x07, 

    0x80, 0xFA, 0x23, 0x80, 0xE7, 0x04, 0x83, 0xC7, 0x47, 0x04, 0x93, 0x0B, 0x75, 0xFF, 0xB6, 0x84, 
    0xE2, 0x07, 0x93, 0xFB, 0xFB, 0x0F, 0x85, 0x46, 0xAA, 0x89, 0x2E, 0x8B, 0x32, 0x89, 0x37, 0x24, 
    0x00, 0x40, 0xE1, 0x87, 0x01, 0x57, 0x63, 0xFA, 0x76, 0x01, 0x63, 0x08, 0xD5, 0x00, 0x89, 0x46, 
    0x13, 0x07, 0x00, 0x02, 0x63, 0x13, 0xD5, 0x00, 0x01, 0x57, 0xD9, 0x8F, 0x93, 0xF7, 0xF7, 0x0F, 

    0xB7, 0x1C, 0x00, 0x40, 0x23, 0x82, 0xFC, 0x04, 0x11, 0x47, 0x23, 0x03, 0xE4, 0x80, 0x13, 0x05, 
    0xF0, 0x0F, 0x65, 0x3D, 0x09, 0x4C, 0xD1, 0x35, 0x63, 0x6D, 0x7C, 0x11, 0xB7, 0x05, 0x07, 0x00, 
    0xDA, 0x95, 0x37, 0x87, 0x07, 0x00, 0x79, 0x55, 0x63, 0xF2, 0xE5, 0x04, 0xB3, 0x87, 0x95, 0x00, 
    0x63, 0x6E, 0xF7, 0x02, 0x37, 0x0B, 0x08, 0x00, 0xA9, 0x47, 0x33, 0xEB, 0x65, 0x01, 0x63, 0x99, 

    0xF9, 0x06, 0x89, 0xE4, 0x81, 0x44, 0x51, 0x3D, 0x26, 0x85, 0x0D, 0xA0, 0xDA, 0x85, 0x09, 0x45, 
    0x55, 0x3D, 0x05, 0x09, 0x03, 0x45, 0xF9, 0xFF, 0xFD, 0x14, 0x05, 0x0B, 0x69, 0x3D, 0x81, 0xC4, 
    0x93, 0x77, 0xFB, 0x0F, 0xFD, 0xF7, 0xDD, 0x35, 0x69, 0xFD, 0x7D, 0x55, 0xB7, 0x17, 0x00, 0x40, 
    0x13, 0x07, 0x70, 0x05, 0x23, 0x80, 0xE7, 0x04, 0x13, 0x07, 0x80, 0xFA, 0x23, 0x80, 0xE7, 0x04, 

    0x03, 0xC7, 0x47, 0x04, 0x41, 0x8B, 0x23, 0x82, 0xE7, 0x04, 0xF2, 0x50, 0xB7, 0xE7, 0x00, 0xE0, 
    0x23, 0xA0, 0x57, 0x11, 0x23, 0xA2, 0x47, 0x11, 0xE2, 0x54, 0x32, 0x44, 0x52, 0x59, 0xC2, 0x59, 
    0x32, 0x5A, 0xA2, 0x5A, 0x12, 0x5B, 0x82, 0x5B, 0x72, 0x4C, 0xE2, 0x4C, 0x21, 0x61, 0x82, 0x80, 
    0xA5, 0x47, 0x63, 0x95, 0xF9, 0x06, 0x85, 0x69, 0x13, 0x09, 0xF0, 0x0F, 0xB3, 0x06, 0x99, 0x00, 

    0xB3, 0x74, 0x2B, 0x01, 0xB6, 0x94, 0x13, 0x49, 0xF9, 0xFF, 0xB3, 0x74, 0x99, 0x00, 0x85, 0x6B, 
    0x33, 0x79, 0x69, 0x01, 0x41, 0x6B, 0x93, 0x87, 0xF9, 0xFF, 0xB3, 0xF7, 0x27, 0x01, 0x99, 0xE3, 
    0x63, 0xFC, 0x34, 0x01, 0x93, 0xD9, 0x49, 0x00, 0xC1, 0x47, 0xE3, 0xE6, 0x37, 0xFF, 0x99, 0xBF, 
    0x05, 0x69, 0xC1, 0x69, 0x7D, 0x19, 0xD9, 0xB7, 0x13, 0x05, 0x80, 0x0D, 0x63, 0x88, 0x69, 0x01, 

    0x13, 0x05, 0x00, 0x02, 0x63, 0x84, 0x79, 0x01, 0x13, 0x05, 0x10, 0x08, 0xCA, 0x85, 0xDD, 0x3B, 
    0x35, 0x3D, 0x21, 0xDD, 0x4E, 0x99, 0xB3, 0x84, 0x34, 0x41, 0xD9, 0xB7, 0xDA, 0x85, 0x2D, 0x45, 
    0xD5, 0x33, 0xCA, 0x94, 0xE3, 0x00, 0x99, 0xF2, 0x05, 0x09, 0x7D, 0x3B, 0xA3, 0x0F, 0xA9, 0xFE, 
    0xD5, 0xBF, 0x93, 0x87, 0xF9, 0xFF, 0x93, 0xF7, 0xF7, 0x0F, 0x63, 0x61, 0xFC, 0x0C, 0x83, 0xC7, 

    0x1C, 0x04, 0x13, 0x07, 0x30, 0x08, 0x63, 0x1F, 0xF7, 0x04, 0x37, 0x07, 0x08, 0x00, 0x63, 0x6B, 
    0xEB, 0x04, 0xB3, 0x07, 0x9B, 0x00, 0xB7, 0x06, 0x10, 0x00, 0x63, 0xF5, 0xD7, 0x04, 0x33, 0x4B, 
    0xEB, 0x00, 0x89, 0x47, 0x63, 0x93, 0xF9, 0x06, 0x89, 0x80, 0xD5, 0x49, 0xE3, 0x8C, 0x04, 0xEC, 
    0xDA, 0x85, 0x09, 0x45, 0x41, 0x3B, 0x11, 0x09, 0x03, 0x27, 0xC9, 0xFF, 0x91, 0x47, 0x23, 0x20, 

    0xE4, 0x80, 0x03, 0x07, 0x64, 0x80, 0xE3, 0x4E, 0x07, 0xFE, 0x23, 0x03, 0x34, 0x81, 0xFD, 0x17, 
    0xED, 0xFB, 0xFD, 0x14, 0x11, 0x0B, 0x81, 0xC4, 0x93, 0x77, 0xFB, 0x0F, 0xE9, 0xFF, 0x7D, 0x33, 
    0x71, 0xF5, 0xE1, 0xB5, 0xB7, 0x17, 0x00, 0x40, 0x03, 0xC7, 0x57, 0x04, 0xB7, 0x07, 0x08, 0x00, 
    0x13, 0x77, 0x07, 0x02, 0x19, 0xE3, 0xB7, 0x87, 0x07, 0x00, 0x79, 0x55, 0xE3, 0x78, 0xFB, 0xEA, 

    0x33, 0x07, 0x9B, 0x00, 0xE3, 0xFF, 0xE7, 0xF8, 0x55, 0xB5, 0x85, 0x47, 0xE3, 0x82, 0xF9, 0xF2, 
    0xDA, 0x85, 0x2D, 0x45, 0x05, 0x3B, 0x93, 0x89, 0xF4, 0xFF, 0xE3, 0x85, 0x04, 0xE6, 0x29, 0x33, 
    0x93, 0xF7, 0x39, 0x00, 0x91, 0xEB, 0x83, 0x26, 0x04, 0x80, 0x03, 0x27, 0x09, 0x00, 0x93, 0x07, 
    0x49, 0x00, 0xE3, 0x9A, 0xE6, 0xE4, 0x3E, 0x89, 0xCE, 0x84, 0xF1, 0xBF, 0xB5, 0x47, 0x63, 0x96, 

    0xF9, 0x00, 0x13, 0x05, 0x90, 0x0B, 0xD1, 0x31, 0x35, 0xBD, 0xB1, 0x47, 0x13, 0x05, 0xB0, 0x0A, 
    0xE3, 0x8B, 0xF9, 0xFE, 0x99, 0x47, 0x63, 0x91, 0xF9, 0x04, 0xB7, 0x05, 0x08, 0x00, 0xB3, 0x65, 
    0xBB, 0x00, 0x2D, 0x45, 0xC5, 0x31, 0x81, 0x44, 0x8D, 0x4B, 0xA1, 0x49, 0x75, 0x39, 0x63, 0x96, 
    0x74, 0x01, 0x83, 0x27, 0x04, 0x80, 0x23, 0x20, 0xF9, 0x00, 0x85, 0x04, 0xE3, 0x98, 0x34, 0xFF, 

    0x83, 0x27, 0x04, 0x80, 0x13, 0x17, 0x2B, 0x01, 0x63, 0x55, 0x07, 0x00, 0x23, 0x12, 0xF9, 0x00, 
    0xD5, 0xBB, 0x23, 0x22, 0xF9, 0x00, 0xFD, 0xB3, 0x9D, 0x47, 0x63, 0x99, 0xF9, 0x02, 0x81, 0x45, 
    0x13, 0x05, 0xB0, 0x04, 0x45, 0x31, 0xBD, 0x44, 0x23, 0x20, 0x09, 0x00, 0x23, 0x22, 0x09, 0x00, 
    0xFD, 0x59, 0x9D, 0x39, 0x93, 0xF7, 0x74, 0x00, 0xCA, 0x97, 0x03, 0xC7, 0x07, 0x00, 0xFD, 0x14, 

    0x39, 0x8D, 0x23, 0x80, 0xA7, 0x00, 0xE3, 0x96, 0x34, 0xFF, 0x6D, 0xBB, 0xA1, 0x47, 0x63, 0x92, 
    0xF9, 0x04, 0x6D, 0x39, 0x81, 0x44, 0x63, 0x0D, 0x0B, 0x00, 0x8D, 0x47, 0x93, 0x04, 0xC0, 0x03, 
    0x63, 0x08, 0xFB, 0x00, 0x93, 0x04, 0x00, 0x05, 0x63, 0x04, 0x8B, 0x01, 0x93, 0x04, 0x40, 0x04, 
    0x13, 0x75, 0xC5, 0x07, 0xE3, 0x08, 0x95, 0xD8, 0x19, 0x45, 0x01, 0x39, 0x39, 0x39, 0x05, 0x45, 

    0x29, 0x31, 0x26, 0x85, 0x0D, 0x39, 0x09, 0x45, 0x3D, 0x31, 0x49, 0x31, 0xE3, 0x1C, 0x05, 0xD6, 
    0x69, 0xBB, 0x91, 0x47, 0x63, 0x99, 0xF9, 0x00, 0x13, 0x05, 0x60, 0x06, 0xFD, 0x36, 0xF5, 0x3E, 
    0x13, 0x05, 0x90, 0x09, 0x0D, 0xB7, 0xE3, 0x8F, 0x09, 0xD4, 0xF1, 0x54, 0xA9, 0xBB, 0xff ,0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};
uint8_t flash_opl103[ ]={
	0x01, 0x11, 0x02, 0xCE, 0x93, 0x77, 0x15, 0x00, 0x99, 0xCF, 0xB7, 0x06, 0x67, 0x45, 0xB7, 0x27, 
    0x02, 0x40, 0x93, 0x86, 0x36, 0x12, 0x37, 0x97, 0xEF, 0xCD, 0xD4, 0xC3, 0x13, 0x07, 0xB7, 0x9A, 
    0xD8, 0xC3, 0xD4, 0xD3, 0xD8, 0xD3, 0x93, 0x77, 0x25, 0x00, 0x9D, 0xC7, 0xB7, 0x27, 0x02, 0x40, 
    0x98, 0x4B, 0xAD, 0x66, 0x37, 0x38, 0x00, 0x40, 0x13, 0x67, 0x47, 0x00, 0x98, 0xCB, 0x98, 0x4B, 

    0x93, 0x86, 0xA6, 0xAA, 0x13, 0x67, 0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x63, 0x16, 
    0x07, 0x10, 0x98, 0x4B, 0x6D, 0x9B, 0x98, 0xCB, 0x93, 0x77, 0x45, 0x00, 0xA9, 0xCB, 0x93, 0x07, 
    0xF6, 0x0F, 0xA1, 0x83, 0x2E, 0xC6, 0x2D, 0x68, 0x81, 0x76, 0x3E, 0xCA, 0xB7, 0x08, 0x02, 0x00, 
    0xB7, 0x27, 0x02, 0x40, 0x37, 0x33, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0xFD, 0x16, 0x98, 0x4B, 

    0x33, 0x67, 0x17, 0x01, 0x98, 0xCB, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 0x07, 0x04, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x69, 0xE7, 0x98, 0x4B, 0x75, 0x8F, 0x98, 0xCB, 0x32, 0x47, 
    0x13, 0x07, 0x07, 0x10, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 0x69, 0xFB, 0x93, 0x77, 
    0x85, 0x00, 0xF1, 0xCF, 0x93, 0x07, 0xF6, 0x0F, 0x2E, 0xC6, 0xA1, 0x83, 0x3E, 0xCA, 0x37, 0x27, 

    0x02, 0x40, 0x1C, 0x4B, 0xC1, 0x66, 0x2D, 0x68, 0xD5, 0x8F, 0x1C, 0xCB, 0xB7, 0x16, 0x00, 0x20, 
    0xB7, 0x27, 0x02, 0x40, 0x37, 0x03, 0x08, 0x00, 0x13, 0x0E, 0x00, 0x04, 0xB7, 0x0E, 0x04, 0x00, 
    0xB7, 0x38, 0x00, 0x40, 0x13, 0x08, 0xA8, 0xAA, 0x98, 0x4B, 0x33, 0x67, 0x67, 0x00, 0x98, 0xCB, 
    0xD8, 0x47, 0x05, 0x8B, 0x75, 0xFF, 0x32, 0x47, 0x36, 0x8F, 0x3A, 0xC8, 0x72, 0xCC, 0x42, 0x47, 

    0x03, 0x2F, 0x0F, 0x00, 0x91, 0x06, 0x23, 0x20, 0xE7, 0x01, 0x98, 0x4B, 0x33, 0x67, 0xD7, 0x01, 
    0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x21, 0xEB, 0x42, 0x47, 0x36, 0x8F, 0x11, 0x07, 0x3A, 0xC8, 
    0x62, 0x47, 0x7D, 0x17, 0x3A, 0xCC, 0x61, 0xFF, 0x32, 0x47, 0xD8, 0xCB, 0x98, 0x4B, 0x13, 0x67, 
    0x07, 0x04, 0x98, 0xCB, 0xD8, 0x47, 0x05, 0x8B, 0x15, 0xEB, 0xD8, 0x47, 0x41, 0x8B, 0x15, 0xCB, 

    0xD8, 0x47, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x13, 0x67, 0x07, 0x01, 0xD8, 0xC7, 0x98, 0x4B, 
    0x21, 0x45, 0x75, 0x8F, 0x98, 0xCB, 0x05, 0x61, 0x02, 0x90, 0x23, 0x20, 0xD8, 0x00, 0xF5, 0xB5, 
    0x23, 0x20, 0x03, 0x01, 0x3D, 0xB7, 0x23, 0xA0, 0x08, 0x01, 0x65, 0xB7, 0x23, 0xA0, 0x08, 0x01, 
    0xD1, 0xB7, 0x32, 0x47, 0x13, 0x07, 0x07, 0x10, 0x3A, 0xC6, 0x52, 0x47, 0x7D, 0x17, 0x3A, 0xCA, 

    0x25, 0xF7, 0x98, 0x4B, 0xB7, 0x06, 0xF3, 0xFF, 0xFD, 0x16, 0x75, 0x8F, 0x98, 0xCB, 0x41, 0x89, 
    0x19, 0xE1, 0x01, 0x45, 0xC9, 0xB7, 0x2E, 0xC6, 0x0D, 0x06, 0x02, 0xCA, 0x09, 0x82, 0x32, 0xCC, 
    0xB7, 0x17, 0x00, 0x20, 0x98, 0x43, 0x13, 0x86, 0x47, 0x00, 0xD2, 0x47, 0xB2, 0x46, 0x8A, 0x07, 
    0xB6, 0x97, 0x9C, 0x43, 0x63, 0x18, 0xF7, 0x02, 0xD2, 0x47, 0x32, 0x47, 0x8A, 0x07, 0xBA, 0x97, 

    0x98, 0x43, 0xF2, 0x47, 0xBA, 0x97, 0x3E, 0xCE, 0xD2, 0x47, 0x85, 0x07, 0x3E, 0xCA, 0xD2, 0x46, 
    0x62, 0x47, 0xB2, 0x87, 0xE3, 0xE8, 0xE6, 0xFC, 0xB7, 0x27, 0x00, 0x20, 0x98, 0x4B, 0xF2, 0x47, 
    0xE3, 0x09, 0xF7, 0xFA, 0x41, 0x45, 0x85, 0xBF, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
};



void wlink_ramcodewrite(uint8_t *buffer, int size)
{
	unsigned long len = 64;
	int i = 0;
	while (size >= 64)
	{
		pWriteData(0, 2, buffer + 64 * i, &len);
		size -= 64;
		i++;
	}
	if (size)
	{
		len = size;
		pWriteData(0, 2, buffer + 64 * i, &len);
	}
}

void wlink_getromram(uint32_t *rom, uint32_t *ram)
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	bool type_A = false;
	bool type_B = false;
	bool type_C = false;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	txbuf[3] = 0x04;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	if (chip_type == 0x30700508 || chip_type == 0x30710508 || chip_type == 0x30730508 || chip_type == 0x30300504 || chip_type == 0x30310504)
		type_A = true;
	if (chip_type == 0x30720508 || chip_type == 0x30740508)
		type_C = true;
	if (chip_type == 0x2034050c || chip_type == 0x2080050c || chip_type == 0x2081050c || chip_type == 0x2082050c || chip_type == 0x2083050c)
		type_B = true;
	switch (rxbuf[3])
	{
	case 0:
		if (type_B)
		{
			*rom = 128;
			*ram = 64;
		}
		else if (type_A)
		{
			*rom = 192;
			*ram = 128;
		}
		else if (type_C)
		{
			*rom = 192;
			*ram = 128;
		}
		else if (riscvchip == 3)
		{
			*rom = 96;
			*ram = 32;
		}
		else
		{
			*rom = 0;
			*ram = 0;
		}
		break;
	case 1:
		if (type_B)
		{
			*rom = 144;
			*ram = 48;
		}
		else if (type_A)
		{
			*rom = 224;
			*ram = 96;
		}
		else if (type_C)
		{
			*rom = 224;
			*ram = 96;
		}
		else if (riscvchip == 3)
		{
			*rom = 64;
			*ram = 64;
		}
		else
		{
			*rom = 0;
			*ram = 0;
		}
		break;
	case 2:
		if (type_B)
		{
			*rom = 160;
			*ram = 32;
		}
		else if (type_A)
		{
			*rom = 256;
			*ram = 64;
		}
		else if (type_C)
		{
			*rom = 0;
			*ram = 0;
		}
		else if (riscvchip == 3)
		{
			*rom = 32;
			*ram = 96;
		}
		else
		{
			*rom = 0;
			*ram = 0;
		}
		break;
	case 3:
		if (type_B)
		{
			*rom = 160;
			*ram = 32;
		}
		else if (type_A)
		{
			*rom = 288;
			*ram = 32;
		}
		else if (type_C)
		{
			*rom = 0;
			*ram = 0;
		}
		else if (riscvchip == 3)
		{
			*rom = 32;
			*ram = 96;
		}
		else
		{
			*rom = 0;
			*ram = 0;
		}
		break;
	default:
		*rom = 0;
		*ram = 0;
		break;
	}
}
void readmcause();
unsigned char DMI_OP(
	unsigned long iIndex,
	unsigned char iAddr,
	unsigned long iData,
	unsigned char iOP,
	unsigned char *oAddr,
	unsigned long *oData,
	unsigned char *oOP)
{
	unsigned char Txbuf[9];
	unsigned char Rxbuf[9];
	unsigned long len;
	unsigned char *pData;
	unsigned char retrytime;
	Txbuf[0] = 0x81;
	Txbuf[1] = 0x08;
	Txbuf[2] = 0x06;
	Txbuf[3] = iAddr;
	Txbuf[4] = (unsigned char)(iData >> 24);
	Txbuf[5] = (unsigned char)(iData >> 16);
	Txbuf[6] = (unsigned char)(iData >> 8);
	Txbuf[7] = (unsigned char)(iData);
	Txbuf[8] = iOP;
	retrytime = 0;
RETRY:
	len = 9;
	if (pWriteData(gIndex, 1, Txbuf, &len))
	{
		memset(Rxbuf, 0, sizeof(Rxbuf));
		len = 9;

		if (pReadData(gIndex, 1, Rxbuf, &len))
		{

			*oAddr = Rxbuf[3];
			if (oData)
			{
				pData = (unsigned char *)oData;
				*pData = Rxbuf[7];
				*(pData + 1) = Rxbuf[6];
				*(pData + 2) = Rxbuf[5];
				*(pData + 3) = Rxbuf[4];
			}
			*oOP = Rxbuf[8];

			retrytime++;

			if (Rxbuf[8] == 2 && Rxbuf[6] == 3)
			{
				readmcause();
			}

			return true;
		}
	}
	return false;
}

void wlink_reset()
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0b;
	txbuf[2] = 0x01;
	txbuf[3] = 0x03;
	unsigned char oAddr;
	unsigned long oData;
	unsigned char oOP;
	unsigned char iAddr;
	DMI_OP(0, 0x10, 0x80000001, 2, &oAddr, &oData, &oOP);
	usleep(1000);
	oAddr = 0;
	oData = 0;
	oOP = 0;
	iAddr = 0;
	DMI_OP(0, 0x11, iAddr, 1, &oAddr, &oData, &oOP);
	usleep(1000);
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	usleep(1000);
	usleep(1000);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	DMI_OP(0, 0x10, 0x80000001, 2, &oAddr, &oData, &oOP);
	usleep(1000);
	DMI_OP(0, 0x11, iAddr, 1, &oAddr, &oData, &oOP);
}
void wlink_quitreset(void)
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	unsigned char oAddr;
	unsigned long oData;
	unsigned char oOP;
	unsigned char iAddr;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0b;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
    usleep(300000);
	DMI_OP(0, 0x10, 0x40000001, 2, &oAddr, &oData, &oOP);
	usleep(1000);
	oAddr = 0;
	oData = 0;
	oOP = 0;
	iAddr = 0;
	DMI_OP(0, 0x11, iAddr, 1, &oAddr, &oData, &oOP);
}
void wlink_softreset(void){
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0b;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	usleep(300000);
}


void wlink_clean(void){
	unsigned char txbuf[10];
	unsigned char rxbuf[10];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;
	pWriteData(0, 1, txbuf, &len);
	len = 7;
	pReadData(0, 1, rxbuf, &len);
	txbuf[1] = 0x0c;
	txbuf[2] = 0x02;
	txbuf[4] = 0x01;
	len=5;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	txbuf[3] = 0x02;
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 8;
	pReadData(0, 1, rxbuf, &len);	
	txbuf[1]=0x0c;
	txbuf[2]=0x02;
	txbuf[3]=riscvchip;
	txbuf[4]=0x01;
	len=5;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
}

void wlink_chip_reset()
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0b;
	txbuf[2] = 0x01;
	txbuf[3] = 0x02;
	unsigned char oAddr;
	unsigned long oData;
	unsigned char oOP;
	unsigned char iAddr;
	DMI_OP(0, 0x10, 0x80000001, 2, &oAddr, &oData, &oOP);
	usleep(1000);
	oAddr = 0;
	oData = 0;
	oOP = 0;
	iAddr = 0;
	DMI_OP(0, 0x11, iAddr, 1, &oAddr, &oData, &oOP);
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
}
int wlnik_protect_check(void)
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x06;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	if (((rxbuf[0] == 0x82) && (rxbuf[1] == 0x06) && (rxbuf[2] == 0x01) && (rxbuf[3] == 0x01)))
		return 4;
	if (((rxbuf[0] == 0x82) && (rxbuf[1] == 0x06) && (rxbuf[2] == 0x01) && (rxbuf[3] == 0x02)))
		return 5;
	return ERROR_FAIL;
}
int wlink_flash_protect(bool stat)
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x06;
	txbuf[2] = 0x01;
	if (stat)
		txbuf[3] = 0x03;
	else
		txbuf[3] = 0x02;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	if (((rxbuf[0] == 0x82) && (rxbuf[1] == 0x06) && (rxbuf[2] == 0x01) && (rxbuf[3] == txbuf[3])))
	{
		wlink_reset();
		usleep(300000);
		int ret = wlnik_protect_check();
		if ((stat) && (ret == 4))
			return ERROR_OK;
		if ((!stat) && (ret == 5))
			return ERROR_OK;
	}
	return ERROR_FAIL;
}

int wlink_ready_write(uint32_t address, uint32_t count)
{
	unsigned char txbuf[24];
	unsigned char rxbuf[24];
	unsigned long len = 4;
	unsigned long chipiaddr1 = chipiaddr + address;
	if (chipiaddr1 >= 0x10000000)
		chipiaddr1 -= 0x08000000;
	txbuf[0] = 0x81;
	txbuf[1] = 0x02;
	txbuf[2] = 0x01;
	txbuf[3] = 0x06;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	txbuf[0] = 0x81;
	txbuf[1] = 0x01;
	txbuf[2] = 0x08;
	txbuf[3] = (uint8_t)(chipiaddr1 >> 24);
	txbuf[4] = (uint8_t)(chipiaddr1 >> 16);
	txbuf[5] = (uint8_t)(chipiaddr1 >> 8);
	txbuf[6] = (uint8_t)chipiaddr1;
	txbuf[7] = (uint8_t)(count >> 24);
	txbuf[8] = (uint8_t)(count >> 16);
	txbuf[9] = (uint8_t)(count >> 8);
	txbuf[10] = (uint8_t)count;
	len = 11;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	txbuf[0] = 0x81;
	txbuf[1] = 0x02;
	txbuf[2] = 0x01;
	txbuf[3] = 0x05;
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	switch (riscvchip)
	{
	case 3:
		wlink_ramcodewrite(flash_op569, sizeof(flash_op569));
		break;
	case 1:
		wlink_ramcodewrite(flash_op103, sizeof(flash_op103));
		break;
	case 2:
		wlink_ramcodewrite(flash_op573, sizeof(flash_op573));
		break;
	case 7:
	case 0x0b:
		wlink_ramcodewrite(flash_op583, sizeof(flash_op583));
		break;
	case 5:
	case 6:
		wlink_ramcodewrite(flash_op307, sizeof(flash_op307));
		break;
	case 9:
		wlink_ramcodewrite(flash_op003, sizeof(flash_op003));
		break;
	case 0x0a:
		wlink_ramcodewrite(flash_op8571, sizeof(flash_op8571));
		break;
	case 0x0c:
		wlink_ramcodewrite(flash_op643, sizeof(flash_op8571));
		break;
	case 0x0e:
		wlink_ramcodewrite(flash_opl103, sizeof(flash_opl103));
		break;
	default:;
	}
	txbuf[0] = 0x81;
	txbuf[1] = 0x02;
	txbuf[2] = 0x01;
	txbuf[3] = 0x07;
	if ((riscvchip == 0x1) || (pageerase)|| (writeloop>0))
	{
		txbuf[3] = 0x0b;
	}
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	return rxbuf[3];
}

void wlink_endprogram(void)
{
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x02;
	txbuf[2] = 0x01;
	txbuf[3] = 0x08;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
}

int wlink_fastprogram(uint8_t *buffer, int packsize)
{
	unsigned long len = 64;
	unsigned char rxbuf[4];
	for (int i = 0; i < packsize / 64; i++)
	{
		pWriteData(0, 2, (buffer + i * 64), &len);
		len = 64;
	}
	len = 4;
	if (pReadData(0, 2, rxbuf, &len))
	{
		if ((rxbuf[3] == 0x02) || (rxbuf[3] == 0x04))
			return ERROR_OK;
	}
	return ERROR_FAIL;
}

int WriteNonFullPage(unsigned long iaddr,
					 unsigned char *ibuff,
					 unsigned long ilen)
{
	unsigned char txbuf[8];
	unsigned char rxbuf[8];
	unsigned long len;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0A;
	txbuf[2] = 0x05;
	iaddr += chipiaddr;
	txbuf[3] = (unsigned char)(iaddr >> 24);
	txbuf[4] = (unsigned char)(iaddr >> 16);
	txbuf[5] = (unsigned char)(iaddr >> 8);
	txbuf[6] = (unsigned char)(iaddr);
	txbuf[7] = (unsigned char)ilen;
	len = 8;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	len = ilen;
	pWriteData(0, 2, ibuff, &len);
	len = 4;
	if (pReadData(0, 2, rxbuf, &len))
	{
		if (((rxbuf[0] == 0x41) && (rxbuf[1] == 0x01) && (rxbuf[2] == 0x01) && (rxbuf[3] == 0x02)))
			return ERROR_OK;
	}
	return ERROR_FAIL;
}

int wlink_erase(void)
{
	int ret;
	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x02;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;
	ret = pWriteData(0, 1, txbuf, &len);
	len = 4;
	ret = pReadData(0, 1, rxbuf, &len);
	return ret;
}
void readmcause()
{
	unsigned char oAddr;
	unsigned long oData;
	unsigned char oOP;
	DMI_OP(0, 0x16, 0x00000700, 2, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x17, 0x220342, 2, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x16, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x4, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x17, 0x220343, 2, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x16, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x4, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x20, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x21, 0, 1, &oAddr, &oData, &oOP);
	DMI_OP(0, 0x22, 0, 1, &oAddr, &oData, &oOP);
}

void wlink_endprocess(void)
{

	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	txbuf[3] = 0xff;
	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
}

void wlink_pow3v3( bool set){

if(wlinkw || wlinke){
	    unsigned char txbuf[4];
		unsigned char rxbuf[4];
		unsigned long len = 4;
		txbuf[0] = 0x81;
		txbuf[1] = 0x0d;
		txbuf[2] = 0x01;
		if(set)
			txbuf[3] = 0x09;
		else
			txbuf[3] =0x0a;
		len = 4;
		pWriteData(0, 1, txbuf, &len);
		len = 4;
		pReadData(0, 1, rxbuf, &len);
		if(rxbuf[3]==0x09)
			LOG_INFO(" POWER 3V3  ENABLE");
		else if(rxbuf[3]==0x0a){
			LOG_INFO(" POWER 3V3  DISABLE");				
				// exit(0);
			}
		else
			LOG_ERROR("POWER SET FAILED ");
	
		}else{

			LOG_ERROR("This LINK dont support this function");

		}


}

void wlink_pow5v( bool set){

	if(wlinkw || wlinke){
	    unsigned char txbuf[4];
		unsigned char rxbuf[4];
		unsigned long len = 4;
		txbuf[0] = 0x81;
		txbuf[1] = 0x0d;
		txbuf[2] = 0x01;
		if(set)
			txbuf[3] = 0x0b;
		else
			txbuf[3] =0x0c;
		len = 4;
		pWriteData(0, 1, txbuf, &len);
		len = 4;
		pReadData(0, 1, rxbuf, &len);
		if(rxbuf[3]==0x0b)
			LOG_INFO(" POWER 5V  ENABLE");
		else if(rxbuf[3]==0x0c)
			LOG_INFO(" POWER 5V  DISABLE");
		else
			LOG_ERROR("POWER SET FAILED ");
		
	
		}else{

			LOG_ERROR("This LINK dont support this function");

		}


}

void wlink_rstout(int state){

	unsigned char txbuf[4];
	unsigned char rxbuf[4];
	unsigned long len = 4;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	if(state==0)
		txbuf[3] = 0x13;
	else if(state==1)	
		txbuf[3] = 0x14;
	else if(state==2)	
		txbuf[3] = 0x15;
	pWriteData(0, 1, txbuf, &len);
	len = 4;
	pReadData(0, 1, rxbuf, &len);
	if((rxbuf[2]==0x01) &&(rxbuf[3]==0x00)){
		if(state==0)
			LOG_INFO(" RST PUSH_PULL OUTPUT 0");
		else if(state==1)	
			LOG_INFO(" RST PUSH_PULL OUTPUT 1");
		else if(state==2)	
			LOG_INFO(" RST FLOATING INPUT");

	}else
		LOG_ERROR(" RST SET FAILED");
}


int wlink_init(void)
{
	unsigned char txbuf[6];
	unsigned char rxbuf[20];
	char *wlink_name = NULL;
	unsigned long len = 5;
	txbuf[0] = 0x81;
	txbuf[1] = 0x0d;
	txbuf[2] = 0x01;
	txbuf[3] = 0x01;

#ifdef _WIN32
	OSVERSIONINFO version;

	version.dwOSVersionInfoSize = sizeof version;
	if (!GetVersionEx(&version))
	{
		LOG_ERROR("GetVersionEx error");
		return ERROR_FAIL;
	}
	if (version.dwPlatformId != VER_PLATFORM_WIN32_NT)
	{
		LOG_ERROR("Not Win32 Platform");
		return ERROR_FAIL;
	}
	if (hModule == 0)
	{
		hModule = LoadLibrary("WCHLinkDll.dll");
		if (hModule)
		{
			pOpenDev = (pCH375OpenDevice)GetProcAddress(hModule, "CH375OpenDevice");
			pCloseDev = (pCH375CloseDevice)GetProcAddress(hModule, "CH375CloseDevice");
			pSetTimeout = (pCH375SetTimeout)GetProcAddress(hModule, "CH375SetTimeout");
			pReadData = (pCH375ReadEndP)GetProcAddress(hModule, "CH375ReadEndP");
			pWriteData = (pCH375WriteEndP)GetProcAddress(hModule, "CH375WriteEndP");
			if (pOpenDev == NULL || pCloseDev == NULL || pSetTimeout == NULL || pReadData == NULL || pWriteData == NULL)
			{
				LOG_ERROR("GetProcAddress error");
				return ERROR_FAIL;
			}
			if (pOpenDev(gIndex) == -1)
			{
				gOpen = FALSE;
				LOG_ERROR("WLink Open Error");
				return ERROR_FAIL;
			}
			pSetTimeout(gIndex, 5000, 5000);
		}
	}
#else if

	if (jtag_libusb_open(wlink_vids, wlink_pids, &wfd, NULL) != ERROR_OK)
	{
		LOG_ERROR("open failed");
		goto error_wlink;
	}
	jtag_libusb_set_configuration(wfd, 0);
	if (libusb_claim_interface(wfd, 0) != ERROR_OK)
	{
		LOG_ERROR("claim interface failed");
		goto error_wlink;
	}

#endif	


	len = 4;
	pWriteData(0, 1, txbuf, &len);
	len = 7;
	if (pReadData(0, 1, rxbuf, &len))
	{

		switch (rxbuf[5])
		{
		case 1:
			wlink_name = "WCH-Link-CH549  mode:RV";
			wlink549 = true;
			break;
		case 2:
		case 0x12:
			wlink_name = "WCH-LinkE  mode:RV";
			wlinke = true;
			break;
		case 3:
			wlink_name = "WCH-LinkS  mode:RV";
			break;
		case 5:
		case 0x85:
			wlink_name = "WCH-LinkW  mode:RV";
			wlinkw = true;
			break;
		default:
			LOG_ERROR("unknow WCH-LINK ");
			goto error_wlink;
			break;
		}
		LOG_INFO("%s version %d.%d ", wlink_name, rxbuf[3], rxbuf[4]);

	

			txbuf[0] = 0x81;
			txbuf[1] = 0x0c;
			txbuf[2] = 0x02;
			txbuf[3] = 0x01;
			txbuf[4] = sp;
			len=5;
		pWriteData(0, 1, txbuf, &len);
		len=4;
		pReadData(0, 1, rxbuf, &len);
		txbuf[1] = 0x0d;
		txbuf[2] = 0x01;
		txbuf[3] = 0x02;
		len = 4;
		pWriteData(0, 1, txbuf, &len);
		len = 8;
		pReadData(0, 1, rxbuf, &len);
		if (((rxbuf[0] == 0x81) && (rxbuf[1] == 0x55) && (rxbuf[2] == 0x01) && (rxbuf[3] == 0x01)))
		{
			LOG_ERROR(" WCH-Link failed to connect with riscvchip");
			LOG_ERROR(" 1.Make sure the two-line debug interface has been opened. If not, set board to boot mode then use ISP tool to open it");
			LOG_ERROR(" 2.Please check your physical link connection");
			if (wlink549)
				LOG_ERROR(" if your chip is CH32V00X,WCH-Link-CH549 does not support this chip, please use WCH-LinkE");
			if(wlinkw)
				LOG_ERROR(" if your chip is CH56X/CH57X/CH58X/CH59X,WCH-LinkW does not support this chip, please use WCH-LinkE");
			goto error_wlink;
		}
		chip_type = (((unsigned int)rxbuf[4]) << 24) + (((unsigned int)rxbuf[5]) << 16) + (((unsigned int)rxbuf[6]) << 8) + (((unsigned int)rxbuf[7]));
		chip_type = chip_type & 0xffffff0f;
		if((chip_type==0x30520508)   ||  (chip_type == 0x305b0508))
			pageerase=true;
		switch (rxbuf[3])
		{
		case 1:
		{
			riscvchip = 0x01;
			chipiaddr = 0x08000000;
			pagesize = 128;
			txbuf[0] = 0x81;
			txbuf[1] = 0x0d;
			txbuf[2] = 0x01;
			txbuf[3] = 0x03;
			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);
			txbuf[3] = 0x10;
			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);

			break;
		}
		case 2:
		{
			riscvchip = 0x02;
			chipiaddr = 0x00000000;
			pagesize = 256;
			LOG_WARNING(" The debug interface has been opened,there is a risk of code leakage ,ensure that the debug interface has been closed before leaving factory !");
			break;
		}
		case 3:
		{
			riscvchip = 0x03;
			chipiaddr = 0x0000;
			pagesize = 256;
			LOG_WARNING(" The debug interface has been opened,there is a risk of code leakage ,ensure that the debug interface has been closed before leaving factory !");
			txbuf[0] = 0x81;
			txbuf[1] = 0x0d;
			txbuf[2] = 0x01;
			txbuf[3] = 0x04;

			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);

			switch (rxbuf[3])
			{
			case 0:
			{
				ramaddr = 0x8000;
				break;
			}
			case 1:
			{
				ramaddr = 0x10000;
				break;
			}
			case 3:
			{
				ramaddr = 0x18000;
				break;
			}
			default:
				LOG_ERROR(" unknow CH56X riscvchip");
				goto error_wlink;
			}

			break;
		}
		case 5:
		{
			riscvchip = 0x05;
			chipiaddr = 0x08000000;
			pagesize = 256;
			break;
		}
		case 6:
		{
			riscvchip = 0x06;
			chipiaddr = 0x08000000;
			pagesize = 256;
			txbuf[3] = 0x03;
			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);
			break;
		}
		case 7: //
		{
			riscvchip = 0x07;
			chipiaddr = 0x00000000;
			pagesize = 256;
			LOG_WARNING(" The debug interface has been opened,there is a risk of code leakage ,ensure that the debug interface has been closed before leaving factory !");
			break;
		}
		case 9: //
		{
			riscvchip = 0x09;
			chipiaddr = 0x08000000;
			pagesize = 64;
			txbuf[3] = 0x03;
			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);
			break;
		}
		case 0x0a:
		{
			riscvchip = 0x0a;
			chipiaddr = 0x00000000;
			pagesize = 256;
			txbuf[3] = 0x03;
			len = 4;
			pWriteData(0, 1, txbuf, &len);
			len = 4;
			pReadData(0, 1, rxbuf, &len);

			break;
		}
		case 0x0b: //
		{
			riscvchip = 0x0b;
			chipiaddr = 0x00000000;
			pagesize = 256;
			break;
		}
		case 0x0c:
		case 0x0d: //
		{
			riscvchip = 0x0c;
			chipiaddr = 0x08000000;
			pagesize = 256;
			break;
		}
		case 0x0e: //
		{
			riscvchip = 0x0e;
			chipiaddr = 0x08000000;
			pagesize = 256;
			break;
		}
		default:
			LOG_ERROR(" communication fail,please contact [support@mounriver.com]");
			goto error_wlink;
		}
#ifdef _WIN32
		gOpen = TRUE;
#endif
	}
	else
	{
		return ERROR_FAIL;
	}
	LOG_INFO("wlink_init ok");
	if(iocontrol){
			switch (iocontrol)
				{
				case 1:
					wlink_pow3v3(powstat);
					break;
				case 2:
					wlink_pow5v(powstat);
					break;
				case 3:
					wlink_rstout(poutput);
					break;
				default:
					
					goto error_wlink;
					break;
				}
				usleep(10000);
				return ERROR_OK;
		}

	return ERROR_OK;
#ifdef _WIN32
error_wlink:

	wlink_endprocess();
	pCloseDev(gIndex);
	if (hModule)
	{
		FreeLibrary(hModule);
		hModule = 0;
	}
	return ERROR_FAIL;
#else
error_wlink:
	if (wfd)
	{

		wlink_endprocess();
		jtag_libusb_close(wfd);
	}
	return ERROR_FAIL;
#endif
}

int wlink_quit(void)
{
#ifdef _WIN32
	if (gOpen)
	{
		wlink_endprocess();
		pCloseDev(gIndex);
		gOpen = FALSE;
	}
	if (hModule)
	{
		FreeLibrary(hModule);
		hModule = 0;
	}
#else if
	wlink_endprocess();
	jtag_libusb_close(wfd);
#endif
	return ERROR_OK;
}

void wlink_disabledebug(void)
{
	if ((riscvchip == 0x02) || (riscvchip == 0x03) || (riscvchip == 0x07)|| (riscvchip == 0x0b))
	{
		unsigned char txbuf[4];
		unsigned char rxbuf[4];
		unsigned long len = 4;
		txbuf[0] = 0x81;
		txbuf[1] = 0x0e;
		txbuf[2] = 0x01;
		txbuf[3] = 0x01;
		len = 4;
		pWriteData(0, 1, txbuf, &len);
		len = 4;
		pReadData(0, 1, rxbuf, &len);
	}
}



int wlink_write(const uint8_t *buffer, uint32_t offset, uint32_t count)
{
	int packsize = 4096;

	if (riscvchip == 0x09)
		packsize = 1024;
	uint8_t *buf_bin;
	buf_bin = malloc(packsize);
	memset(buf_bin, 0xff, packsize);

	int binlength = count;
	wlink_ready_write(offset, count);

	if (binlength <= packsize)
	{
		for (int i = 0; i < count; i++)
		{
			buf_bin[i] = *(buffer + i);
		}
		int ret = wlink_fastprogram(buf_bin, packsize);
		if (ret != ERROR_OK)
		{
			return ERROR_FAIL;
		}
	}
	else
	{
		while (binlength >= packsize)
		{
			for (int i = 0; i < packsize; i++)
			{
				buf_bin[i] = *(buffer + i);
			}
			int ret = wlink_fastprogram(buf_bin, packsize);
			if (ret != ERROR_OK)
			{
				return ERROR_FAIL;
			}
			binlength -= packsize;
			buffer += packsize;
		}
		if (binlength > 0)
		{
			memset(buf_bin, 0xff, packsize);
			for (int i = 0; i < binlength; i++)
			{
				buf_bin[i] = *(buffer + i);
			}
			int ret = wlink_fastprogram(buf_bin, packsize);
			if (ret != ERROR_OK)
			{
				return ERROR_FAIL;
			}
		}
	}
	wlink_endprogram();
	return ERROR_OK;
}
int wlink_speed(int speed ){
		unsigned char txbuf[5];
		unsigned char rxbuf[4];
		unsigned long len = 5;
		txbuf[0]=0x81;
		txbuf[1]=0x0c;
		txbuf[2]=0x02;
		txbuf[3]=riscvchip;
		
	switch (speed)
		{
		case 6000:
			txbuf[4]=1;
			break;
		case 4000:
			txbuf[4]=2;
			break;
		case 400:
			txbuf[4]=3;
			break;
		default:
			LOG_WARNING("unknow speed config");
			txbuf[4]=1;
			break;
		}
	sp=txbuf[4];
	pWriteData(0, 1, txbuf, &len);
	len=4;
	pReadData(0, 1, rxbuf, &len);
	if (((rxbuf[0] == 0x82) && (rxbuf[1] == 0x0c) && (rxbuf[2] == 0x01) && (rxbuf[3] == 0x01)))
		return ERROR_OK;
	return ERROR_FAIL;
}

int wlink_speed_div(int speed, int *khz)
{
	*khz = speed;

	return ERROR_OK;
}
static int wlink_khz(int khz, int *speed)
{
	*speed = khz;

	return ERROR_OK;
}


COMMAND_HANDLER(wlink_set_address)
{

	if (CMD_ARGC == 1)
		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[0], wlink_address);
	return ERROR_OK;
}

COMMAND_HANDLER(rst_set)
{
	iocontrol=3;
	if (CMD_ARGC == 1)
		COMMAND_PARSE_NUMBER(ulong, CMD_ARGV[0], poutput);
	
	


	if((poutput !=1)&&(poutput !=0)&&(poutput !=2)){
		
		LOG_ERROR("invalid parameter");
		return ERROR_FAIL;
	}

	return ERROR_OK;
}

COMMAND_HANDLER(wlink_set_index)
{
	if (CMD_ARGC == 1)
		COMMAND_PARSE_NUMBER(u32, CMD_ARGV[0], gIndex);
	return ERROR_OK;
}

COMMAND_HANDLER(noload)
{
	noloadflag = true;
	return ERROR_OK;
}
COMMAND_HANDLER(pow3v3)
{
	iocontrol=1;
	COMMAND_PARSE_ON_OFF(CMD_ARGV[0], powstat);
  
	return ERROR_OK;
}
COMMAND_HANDLER(pow5v)
{
	iocontrol=2;
	COMMAND_PARSE_ON_OFF(CMD_ARGV[0], powstat);
  
	return ERROR_OK;
}
COMMAND_HANDLER(disabledebug)
{
	wlink_disabledebug();
	return ERROR_OK;
}
COMMAND_HANDLER(page_erase)
{
	pageerase = true;
	return ERROR_OK;
}
// COMMAND_HANDLER(protect_check)
// {
// 	protectcheck=true;
// 	return ERROR_OK;
// }
static const struct command_registration wlink_command_handlers[] = {
	{
		.name = "wlink_set_index",
		.handler = &wlink_set_index,
		.mode = COMMAND_CONFIG,
		.help = "wlink_set_index num",
		.usage = "set Wlink index",
	},
	{
		.name = "wlink_set_address",
		.handler = &wlink_set_address,
		.mode = COMMAND_CONFIG,
		.help = "wlink_set_address num",
		.usage = "[count]",
	},
	{
		.name = "noload",
		.handler = &noload,
		.mode = COMMAND_CONFIG,
		.help = "noload",
		.usage = "dont download",
	},
	{
		.name = "disabledebug",
		.handler = &disabledebug,
		.mode = COMMAND_CONFIG,
		.help = "disabledebug",
		.usage = "disable debug",
	},
	{
		.name = "page_erase",
		.handler = &page_erase,
		.mode = COMMAND_CONFIG,
		.help = "page_erase",
		.usage = "page erase",
	},
	{
		.name = "pow3v3",
		.handler = &pow3v3,
		.mode = COMMAND_CONFIG,
		.help = "3.3v",
		.usage = "('on'|'off')",
	},
		{
		.name = "pow5v",
		.handler = &pow5v,
		.mode = COMMAND_CONFIG,
		.help = "5v",
		.usage = "('on'|'off')",
	},
	{
		.name = "rst_set",
		.handler = &rst_set,
		.mode = COMMAND_CONFIG,
		.help = "",
		.usage = "[count]",
	},
	COMMAND_REGISTRATION_DONE};
static struct sdi_driver wlink_interface = {

	.transfer = &DMI_OP,
};

struct adapter_driver wlinke_adapter_driver = {
	.name = "wlinke",

	.commands = wlink_command_handlers,
	.transports = sdi_transports,
	.speed=wlink_speed,
	.khz = wlink_khz,
	.speed_div = wlink_speed_div,
	.init = wlink_init,
	.quit = wlink_quit,
	.sdi_ops = &wlink_interface,
};
